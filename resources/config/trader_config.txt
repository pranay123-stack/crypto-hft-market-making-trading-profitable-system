================================================================================
COMPREHENSIVE TRADER CONFIGURATION GUIDE
================================================================================

OVERVIEW:
--------
This file contains all configuration parameters for traders in the HFT system.
Every setting that a trader can modify or needs to understand is documented here.

Format: YAML with detailed explanations
Location: /config/trader_<name>.yaml
Hot Reload: Supported for most parameters (exceptions marked)
Validation: All parameters validated on load and change

================================================================================
COMPLETE TRADER CONFIGURATION (YAML)
================================================================================

# trader_config.yaml - Complete Template
---
# ============================================================================
# TRADER IDENTIFICATION & PROFILE
# ============================================================================
trader:
  id: "TRADER_001"
  name: "John Doe"
  email: "john.doe@company.com"
  role: "Senior Trader"
  desk: "Crypto Arbitrage"
  location: "New York"
  timezone: "America/New_York"
  start_date: "2025-01-15"

  # Trading authorization level
  authorization_level: 2  # 0=Junior, 1=Intermediate, 2=Senior, 3=Lead

  # Supervisor for escalations
  supervisor: "TRADER_LEAD_001"
  supervisor_email: "lead@company.com"

# ============================================================================
# CAPITAL ALLOCATION
# ============================================================================
capital:
  # Total capital allocated to this trader
  total_allocation: 5000000.00  # USD

  # Per-strategy allocation
  strategy_allocations:
    market_making_btc: 2000000.00
    stat_arb_eth: 1500000.00
    latency_arb: 1000000.00
    momentum: 500000.00

  # Minimum cash buffer (must maintain)
  min_cash_buffer: 500000.00

  # Currency breakdown
  currencies:
    USD: 3000000.00
    USDT: 2000000.00

# ============================================================================
# RISK LIMITS (CRITICAL - Hot Reload: NO)
# ============================================================================
risk_limits:
  # Position limits
  position:
    # Maximum notional position per symbol
    max_position_per_symbol: 500000.00  # USD

    # Maximum total exposure (sum of all positions)
    max_total_exposure: 5000000.00  # USD

    # Maximum number of open positions
    max_open_positions: 50

    # Maximum position concentration (% of total capital)
    max_concentration: 0.40  # 40%

    # Per-exchange position limits
    exchange_limits:
      binance: 2000000.00
      coinbase: 1500000.00
      kraken: 1000000.00
      okx: 500000.00

  # Loss limits
  loss:
    # Maximum loss per trade
    max_loss_per_trade: 5000.00  # USD

    # Maximum daily loss (triggers kill switch)
    max_daily_loss: 50000.00  # USD

    # Maximum weekly loss
    max_weekly_loss: 150000.00  # USD

    # Maximum monthly loss
    max_monthly_loss: 500000.00  # USD

    # Drawdown limits
    max_drawdown_from_peak: 0.15  # 15%
    max_intraday_drawdown: 0.05   # 5%

  # Profit taking
  profit:
    # Daily profit target (pause after reaching)
    daily_profit_target: 100000.00  # USD

    # Action when target reached
    target_action: "pause"  # pause | reduce_size | continue

    # Size reduction factor if reduce_size
    size_reduction_factor: 0.5  # 50%

  # Leverage limits
  leverage:
    max_leverage: 3.0  # Maximum 3x leverage
    default_leverage: 1.0  # Start with no leverage

  # VaR limits (Value at Risk)
  var:
    confidence_level: 0.99  # 99% confidence
    max_daily_var: 100000.00  # USD
    calculation_method: "historical"  # historical | parametric | monte_carlo

# ============================================================================
# APPROVED STRATEGIES
# ============================================================================
strategies:
  # Strategy 1: Market Making
  - name: "market_making_btc"
    enabled: true
    priority: 1  # Higher number = higher priority

    symbols:
      - "BTC/USD"
      - "BTC/USDT"

    exchanges:
      - "binance"
      - "coinbase"

    parameters:
      spread_bps: 10  # 0.10%
      order_size: 0.1  # BTC
      max_position: 2.0  # BTC
      refresh_interval_ms: 100
      inventory_target: 0.0  # Neutral
      skew_enabled: true

    risk_params:
      max_loss_per_day: 10000.00
      max_position_size: 100000.00
      stop_loss_pct: 0.02  # 2%

  # Strategy 2: Statistical Arbitrage
  - name: "stat_arb_eth"
    enabled: true
    priority: 2

    symbols:
      - "ETH/USD"
      - "ETH/BTC"

    exchanges:
      - "binance"
      - "kraken"

    parameters:
      lookback_period: 20  # bars
      entry_threshold: 2.0  # standard deviations
      exit_threshold: 0.5
      position_size: 10.0  # ETH
      half_life: 5  # expected reversion time

    risk_params:
      max_loss_per_day: 15000.00
      max_position_size: 150000.00
      correlation_min: 0.7  # Minimum correlation to trade

  # Strategy 3: Latency Arbitrage
  - name: "latency_arb"
    enabled: false  # Disabled by default (high risk)
    priority: 3
    requires_approval: true  # Needs supervisor approval to enable

    symbols:
      - "BTC/USD"
      - "ETH/USD"

    exchanges:
      - "binance"
      - "coinbase"
      - "kraken"

    parameters:
      min_price_diff_bps: 5  # Minimum 0.05% price difference
      execution_timeout_ms: 50  # Cancel if not filled in 50ms
      max_slippage_bps: 2  # Maximum 0.02% slippage

    risk_params:
      max_loss_per_day: 20000.00
      max_order_size: 50000.00  # USD per leg

# ============================================================================
# TRADING HOURS & SCHEDULE
# ============================================================================
trading_hours:
  # Trading window
  start_time: "09:00:00"  # Local time
  end_time: "16:00:00"    # Local time

  # Days of week (0=Monday, 6=Sunday)
  trading_days: [0, 1, 2, 3, 4]  # Monday-Friday

  # Pre-market preparation
  pre_market_start: "08:30:00"

  # Post-market analysis
  post_market_end: "17:00:00"

  # Holidays (no trading)
  holidays:
    - "2025-01-01"  # New Year
    - "2025-07-04"  # Independence Day
    - "2025-12-25"  # Christmas

  # Reduced trading (50% position limits)
  reduced_trading_days:
    - "2025-12-24"  # Christmas Eve
    - "2025-12-31"  # New Year's Eve

  # Auto-shutdown time (force close all positions)
  auto_shutdown_time: "16:30:00"

  # Emergency trading (outside hours)
  emergency_trading_allowed: false
  emergency_requires_approval: true

# ============================================================================
# ORDER EXECUTION SETTINGS
# ============================================================================
execution:
  # Order types allowed
  allowed_order_types:
    - "LIMIT"
    - "MARKET"  # Use with caution
    - "POST_ONLY"
    - "IOC"  # Immediate or Cancel
    - "FOK"  # Fill or Kill

  # Default order type
  default_order_type: "LIMIT"

  # Time in force
  default_tif: "GTC"  # Good Till Cancel

  # Execution timeout
  order_timeout_seconds: 30

  # Auto-cancel unfilled orders
  auto_cancel_unfilled: true
  auto_cancel_after_seconds: 60

  # Smart order routing
  sor_enabled: true
  sor_algorithm: "volume_weighted"  # volume_weighted | latency | fee_optimized

  # Slippage protection
  max_slippage_bps: 10  # 0.10%
  slippage_check_enabled: true

  # Partial fills
  allow_partial_fills: true
  min_fill_percentage: 0.10  # Accept fills >= 10% of order size

  # Post-trade analysis
  tca_enabled: true  # Transaction Cost Analysis

# ============================================================================
# EXCHANGE CONFIGURATIONS
# ============================================================================
exchanges:
  binance:
    enabled: true
    api_key_id: "binance_key_001"  # Reference to key in secrets manager
    rate_limit_orders_per_second: 10
    rate_limit_messages_per_second: 50

    # Fee tier
    fee_tier: "VIP1"  # Determines trading fees
    maker_fee: 0.0002  # 0.02%
    taker_fee: 0.0004  # 0.04%

    # Symbol-specific settings
    symbols:
      "BTC/USDT":
        enabled: true
        min_order_size: 0.001  # BTC
        max_order_size: 10.0
        tick_size: 0.01  # Price increment
      "ETH/USDT":
        enabled: true
        min_order_size: 0.01  # ETH
        max_order_size: 100.0
        tick_size: 0.01

  coinbase:
    enabled: true
    api_key_id: "coinbase_key_001"
    rate_limit_orders_per_second: 5
    rate_limit_messages_per_second: 20

    fee_tier: "Standard"
    maker_fee: 0.0050  # 0.50%
    taker_fee: 0.0050  # 0.50%

    symbols:
      "BTC/USD":
        enabled: true
        min_order_size: 0.001
        max_order_size: 5.0
        tick_size: 0.01

  kraken:
    enabled: false  # Disabled
    api_key_id: "kraken_key_001"

# ============================================================================
# INSTRUMENTS & SYMBOLS
# ============================================================================
instruments:
  # Approved symbols for trading
  approved_symbols:
    - symbol: "BTC/USD"
      exchanges: ["binance", "coinbase", "kraken"]
      position_limit: 2.0  # BTC
      enabled: true

    - symbol: "BTC/USDT"
      exchanges: ["binance", "okx"]
      position_limit: 2.0
      enabled: true

    - symbol: "ETH/USD"
      exchanges: ["coinbase", "kraken"]
      position_limit: 20.0  # ETH
      enabled: true

    - symbol: "ETH/USDT"
      exchanges: ["binance"]
      position_limit: 20.0
      enabled: true

  # Prohibited symbols (cannot trade)
  prohibited_symbols:
    - "DOGE/*"  # No meme coins
    - "SHIB/*"
    - "*/BUSD"  # BUSD being phased out

# ============================================================================
# NOTIFICATIONS & ALERTS
# ============================================================================
notifications:
  # Notification channels
  channels:
    email:
      enabled: true
      addresses:
        - "john.doe@company.com"
        - "trading-desk@company.com"

    sms:
      enabled: true
      numbers:
        - "+1-555-0100"

    slack:
      enabled: true
      channel: "#crypto-trading"
      mention: "@john.doe"

    telegram:
      enabled: false
      chat_id: "123456789"

  # Alert triggers
  alerts:
    # P1: Critical (immediate response required)
    p1_alerts:
      - "daily_loss_limit_reached"
      - "system_error"
      - "risk_breach"
      - "exchange_connection_lost"
      notify_via: ["sms", "email", "slack"]
      escalate_after_minutes: 5

    # P2: High (response within 15 min)
    p2_alerts:
      - "position_limit_warning"  # 80% of limit
      - "unusual_slippage"
      - "strategy_disabled"
      notify_via: ["email", "slack"]
      escalate_after_minutes: 15

    # P3: Medium (response within 1 hour)
    p3_alerts:
      - "profitable_trade"  # >= $1000
      - "daily_target_reached"
      - "market_data_delayed"
      notify_via: ["slack"]
      escalate_after_minutes: 60

    # P4: Low (informational)
    p4_alerts:
      - "strategy_started"
      - "strategy_stopped"
      - "daily_summary"
      notify_via: ["email"]
      no_escalation: true

  # Quiet hours (reduce notifications)
  quiet_hours:
    enabled: true
    start_time: "18:00:00"
    end_time: "08:00:00"
    allowed_severity: ["P1", "P2"]  # Only critical alerts

# ============================================================================
# MONITORING & REPORTING
# ============================================================================
monitoring:
  # Real-time dashboards
  dashboards:
    - name: "Trading Overview"
      url: "http://grafana.internal/d/trading-overview"
      refresh_seconds: 5

    - name: "P&L Dashboard"
      url: "http://grafana.internal/d/pnl"
      refresh_seconds: 10

    - name: "Risk Dashboard"
      url: "http://grafana.internal/d/risk"
      refresh_seconds: 30

  # Performance metrics
  metrics:
    # Track these KPIs
    track_metrics:
      - "daily_pnl"
      - "total_trades"
      - "win_rate"
      - "sharpe_ratio"
      - "max_drawdown"
      - "average_trade_duration"
      - "fill_rate"
      - "average_slippage"

    # Metric thresholds for alerts
    thresholds:
      win_rate_min: 0.45  # Alert if < 45%
      sharpe_ratio_min: 1.0  # Alert if < 1.0
      fill_rate_min: 0.90  # Alert if < 90%

  # Daily reports
  reports:
    daily_summary:
      enabled: true
      send_time: "17:00:00"
      recipients:
        - "john.doe@company.com"
        - "supervisor@company.com"
      format: "PDF"  # PDF | HTML | CSV

    weekly_performance:
      enabled: true
      send_day: "Friday"
      send_time: "17:00:00"

    monthly_review:
      enabled: true
      send_day: 1  # First of month

# ============================================================================
# SECURITY & COMPLIANCE
# ============================================================================
security:
  # Multi-factor authentication
  mfa_required: true
  mfa_timeout_minutes: 30  # Re-prompt MFA after 30 min

  # IP whitelist (only these IPs can trade)
  ip_whitelist:
    - "192.168.1.100"  # Office
    - "10.0.0.50"      # Home
    - "172.16.0.10"    # VPN

  # API key rotation
  api_key_rotation:
    rotate_every_days: 90
    warning_days_before: 14

  # Session timeout
  session_timeout_minutes: 60

  # Trade confirmation (for large orders)
  trade_confirmation:
    enabled: true
    threshold_usd: 100000.00  # Confirm orders > $100k
    confirmation_method: "mfa"  # mfa | email | sms

compliance:
  # Audit logging
  audit_log:
    enabled: true
    log_level: "detailed"  # minimal | standard | detailed
    retention_days: 2555  # 7 years for regulatory compliance

  # Trade reporting
  regulatory_reporting:
    enabled: true
    jurisdictions:
      - "US_SEC"
      - "US_CFTC"
    real_time_reporting: true

  # Best execution
  best_execution:
    enabled: true
    annual_review_required: true

# ============================================================================
# ADVANCED SETTINGS
# ============================================================================
advanced:
  # Performance tuning
  performance:
    order_queue_size: 10000
    market_data_buffer_size: 100000
    thread_priority: "realtime"  # normal | high | realtime
    cpu_affinity: [0, 1]  # Pin to CPUs 0 and 1

  # Experimental features
  experimental:
    ml_signal_enabled: false
    auto_parameter_tuning: false

  # Debug mode
  debug:
    enabled: false  # NEVER enable in production
    verbose_logging: false
    save_all_market_data: false

# ============================================================================
# EMERGENCY PROCEDURES
# ============================================================================
emergency:
  # Kill switch
  kill_switch:
    enabled: true
    triggers:
      - "daily_loss_limit_reached"
      - "system_malfunction"
      - "manual_trigger"
    action: "close_all_and_cancel"  # close_all_and_cancel | pause | reduce

  # Emergency contacts
  emergency_contacts:
    - name: "Lead Trader"
      phone: "+1-555-0101"
      email: "lead@company.com"
      role: "Primary"

    - name: "Risk Manager"
      phone: "+1-555-0102"
      email: "risk@company.com"
      role: "Risk Escalation"

    - name: "CTO"
      phone: "+1-555-0103"
      email: "cto@company.com"
      role: "Technical Escalation"

  # Manual override
  manual_override:
    enabled: true
    requires_dual_approval: true
    max_duration_minutes: 60
    log_all_actions: true

================================================================================
CONFIGURATION CHANGE MANAGEMENT
================================================================================

HOT RELOAD SUPPORTED:
- Strategy parameters (spread, size, etc.)
- Notification settings
- Monitoring thresholds
- Most operational settings

REQUIRES RESTART:
- Risk limits (for safety)
- Exchange connections
- Thread affinity
- Core system parameters

CHANGE PROCESS:
1. Edit configuration file
2. Validate syntax: `./validate_config.sh trader_config.yaml`
3. Test in staging: `./deploy_config.sh staging trader_config.yaml`
4. Get approval for risk limit changes
5. Deploy to production: `./deploy_config.sh prod trader_config.yaml`
6. Verify changes: `./check_config.sh`

VALIDATION CHECKS:
- YAML syntax
- Value ranges (e.g., risk limits >= 0)
- Required fields present
- Cross-field validation (e.g., total allocation >= sum of strategy allocations)
- Permission checks

ROLLBACK:
Previous configuration versions stored in:
`/config/history/trader_<name>_<timestamp>.yaml`

Rollback command:
`./rollback_config.sh trader_<name> <timestamp>`

================================================================================
COMMON SCENARIOS
================================================================================

SCENARIO 1: Increase Position Limit
------------------------------------
1. Edit risk_limits.position.max_position_per_symbol
2. Get risk manager approval
3. Deploy (requires restart)
4. Monitor closely for 1 hour

SCENARIO 2: Enable New Strategy
---------------------------------
1. Add strategy to strategies list with enabled: true
2. Set conservative parameters initially
3. Deploy (hot reload supported)
4. Monitor for 1 day in reduced size
5. Gradually increase to full size

SCENARIO 3: Change Trading Hours
----------------------------------
1. Edit trading_hours section
2. Coordinate with team
3. Deploy (hot reload supported)
4. Verify auto-shutdown works correctly

SCENARIO 4: Emergency - Pause Trading
---------------------------------------
```bash
# Quick command
./trading_control.sh pause TRADER_001

# Or edit config
emergency.kill_switch.enabled: true
# And trigger manually
```

================================================================================
TROUBLESHOOTING
================================================================================

CONFIG NOT LOADING:
- Check YAML syntax with validator
- Review logs: /var/log/trading/config_errors.log
- Verify file permissions: chmod 600 trader_config.yaml

HOT RELOAD NOT WORKING:
- Some parameters require restart (see list above)
- Check if config reload is locked (during active trading)
- Verify reload service is running: systemctl status config-reloader

VALIDATION FAILING:
- Review error message carefully
- Check value ranges and types
- Verify all required fields present
- Test with minimal config first

================================================================================
BEST PRACTICES
================================================================================

1. ALWAYS test config changes in staging first
2. NEVER disable risk limits without approval
3. Start new strategies with small position sizes
4. Review config changes with supervisor
5. Keep detailed change log
6. Monitor system after any config change
7. Have rollback plan ready
8. Use version control for config files
9. Regular config audits (monthly)
10. Document custom settings and why they were chosen

================================================================================
SUPPORT
================================================================================

Config Issues:    config-support@company.com
Risk Questions:   risk-team@company.com
Emergency:        +1-555-HELP
Documentation:    http://docs.internal/trader-config

Version: 2.0
Last Updated: 2025-11-25
Owner: Trading Infrastructure Team

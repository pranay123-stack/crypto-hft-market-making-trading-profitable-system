================================================================================
                    LINUX NETWORK COMMANDS REFERENCE
                    Advanced Networking for HFT Systems
================================================================================

TABLE OF CONTENTS
-----------------
1. Network Configuration
2. Network Diagnostics
3. Packet Capture and Analysis
4. Network Performance Testing
5. Socket and Connection Management
6. Network Interface Tuning
7. Traffic Control and QoS
8. Network Security
9. Advanced Network Stack
10. Troubleshooting Workflows

================================================================================
1. NETWORK CONFIGURATION
================================================================================

1.1 IP COMMAND (Modern Network Configuration)
----------------------------------------------

# Show all interfaces
ip link show
ip addr show

# Show specific interface
ip addr show eth0

# Bring interface up/down
ip link set eth0 up
ip link set eth0 down

# Assign IP address
ip addr add 192.168.1.100/24 dev eth0

# Remove IP address
ip addr del 192.168.1.100/24 dev eth0

# Add default route
ip route add default via 192.168.1.1

# Show routing table
ip route show

# Show routing for specific destination
ip route get 8.8.8.8

# Add static route
ip route add 10.0.0.0/8 via 192.168.1.254

# Show ARP cache
ip neigh show

# Flush ARP cache
ip neigh flush all

# Show network statistics
ip -s link show eth0

HFT USE CASE: Configure dedicated trading network interface
ONE-LINER: Get interface IP: ip -4 addr show eth0 | grep -oP '(?<=inet\s)\d+(\.\d+){3}'


1.2 ETHTOOL (Network Interface Control)
----------------------------------------

# Show interface information
ethtool eth0

# Show driver information
ethtool -i eth0

# Show statistics
ethtool -S eth0

# Show ring buffer sizes
ethtool -g eth0

# Set ring buffer sizes
ethtool -G eth0 rx 4096 tx 4096

# Show offload settings
ethtool -k eth0

# Disable TCP offload (for low latency)
ethtool -K eth0 tso off
ethtool -K eth0 gso off
ethtool -K eth0 gro off
ethtool -K eth0 lro off

# Show interrupt coalescing
ethtool -c eth0

# Disable interrupt coalescing (low latency)
ethtool -C eth0 adaptive-rx off adaptive-tx off
ethtool -C eth0 rx-usecs 0 tx-usecs 0

# Show link speed
ethtool eth0 | grep Speed

# Set link speed (disable auto-negotiation)
ethtool -s eth0 speed 10000 duplex full autoneg off

# Show hardware timestamping capabilities
ethtool -T eth0

# Test interface (LED blink)
ethtool -p eth0 10

HFT USE CASE: Disable all offloading for deterministic latency
PERFORMANCE IMPACT: +2-5μs latency but more predictable
SAFETY WARNING: Changes lost on reboot without persistence


1.3 NETWORK MANAGER CONTROL
----------------------------

# Show connection status
nmcli device status

# Show connection details
nmcli connection show

# Disconnect interface
nmcli device disconnect eth0

# Connect interface
nmcli device connect eth0

# Modify connection
nmcli connection modify eth0 ipv4.addresses 192.168.1.100/24
nmcli connection modify eth0 ipv4.gateway 192.168.1.1
nmcli connection modify eth0 ipv4.dns 8.8.8.8

# Disable NetworkManager for interface
nmcli device set eth0 managed no

HFT USE CASE: Often disable NetworkManager for trading interfaces
BEST PRACTICE: Use static configuration for trading networks


================================================================================
2. NETWORK DIAGNOSTICS
================================================================================

2.1 SS (Socket Statistics - Modern netstat)
--------------------------------------------

# Show all sockets
ss -a

# Show TCP sockets
ss -t

# Show UDP sockets
ss -u

# Show listening sockets
ss -l

# Show established connections
ss -t state established

# Show process using socket
ss -p

# Show socket memory usage
ss -m

# Detailed socket information
ss -e

# Show TCP with timers
ss -o

# Numeric output (no DNS resolution)
ss -n

# Show specific port
ss -tn sport = :8080

# Show connections to specific host
ss -tn dst 192.168.1.100

# Show socket statistics
ss -s

# Monitor connections in real-time
watch -n 1 'ss -tan | grep ESTABLISHED | wc -l'

# Show TCP connection state distribution
ss -tan | awk '{print $1}' | sort | uniq -c

HFT USE CASE: Monitor FIX session states
ONE-LINER: Count ESTABLISHED: ss -tan | grep ESTAB | wc -l

OUTPUT INTERPRETATION:
State      Recv-Q Send-Q Local Address:Port  Peer Address:Port
ESTAB      0      0      192.168.1.100:8080  192.168.1.200:52314

Recv-Q > 0 = Application not reading fast enough
Send-Q > 0 = Network congestion or slow peer


2.2 NETSTAT (Network Statistics)
---------------------------------

# Show all connections
netstat -a

# Show listening ports
netstat -l

# Numeric output
netstat -n

# Show process/program
netstat -p

# Show routing table
netstat -r

# Show interface statistics
netstat -i

# Show network statistics by protocol
netstat -s

# Continuous monitoring
netstat -c

# Show TCP connections
netstat -tn

# Show listening TCP ports
netstat -tln

# Show UDP connections
netstat -un

# Combined options
netstat -tulpn

HFT USE CASE: Quick check of listening services
ONE-LINER: Show listeners: netstat -tln | grep LISTEN


2.3 PING (Connectivity Test)
-----------------------------

# Basic ping
ping 192.168.1.1

# Send specific count
ping -c 10 192.168.1.1

# Set interval (requires root for < 1s)
ping -i 0.2 192.168.1.1

# Flood ping (max speed)
ping -f 192.168.1.1

# Set packet size
ping -s 1472 192.168.1.1

# Set TTL
ping -t 64 192.168.1.1

# Timestamp packets
ping -D 192.168.1.1

# Quiet output (summary only)
ping -q -c 100 192.168.1.1

# Specify source interface
ping -I eth0 192.168.1.1

# IPv6 ping
ping6 2001:db8::1

HFT USE CASE: Verify exchange connectivity and latency
ONE-LINER: Average latency: ping -c 100 -q 192.168.1.1 | grep avg | awk -F'/' '{print $5}'

LATENCY TARGETS:
  Same rack: < 0.1ms
  Same datacenter: < 0.5ms
  Same region: < 5ms


2.4 TRACEROUTE / TRACEPATH
---------------------------

# Trace route to destination
traceroute 8.8.8.8

# Use ICMP instead of UDP
traceroute -I 8.8.8.8

# Use TCP
traceroute -T -p 80 8.8.8.8

# No DNS resolution
traceroute -n 8.8.8.8

# Set max hops
traceroute -m 15 8.8.8.8

# Tracepath (no root required)
tracepath 8.8.8.8

# Show MTU along path
tracepath -n 192.168.1.1

HFT USE CASE: Identify routing issues to exchange
PERFORMANCE IMPACT: Minimal, diagnostic only


2.5 MTR (My Traceroute - Enhanced)
-----------------------------------

# Interactive traceroute
mtr 8.8.8.8

# Report mode
mtr -r -c 100 8.8.8.8

# No DNS resolution
mtr -n 8.8.8.8

# Use TCP instead of ICMP
mtr -T -P 443 8.8.8.8

# Show both sent and received
mtr -b 8.8.8.8

# JSON output
mtr -j -c 10 8.8.8.8

HFT USE CASE: Continuous monitoring of exchange connectivity
ONE-LINER: mtr -r -c 100 -n exchange.com > connectivity_report.txt


================================================================================
3. PACKET CAPTURE AND ANALYSIS
================================================================================

3.1 TCPDUMP (Packet Capture)
-----------------------------

# Capture all packets on interface
tcpdump -i eth0

# Capture with full packet size
tcpdump -i eth0 -s 65535

# Write to file
tcpdump -i eth0 -w capture.pcap

# Read from file
tcpdump -r capture.pcap

# Show in hex and ASCII
tcpdump -i eth0 -X

# Show only IP addresses (no DNS)
tcpdump -i eth0 -n

# Capture specific port
tcpdump -i eth0 port 8080

# Capture specific host
tcpdump -i eth0 host 192.168.1.100

# Capture TCP only
tcpdump -i eth0 tcp

# Capture UDP only
tcpdump -i eth0 udp

# Capture specific port range
tcpdump -i eth0 portrange 8000-9000

# Capture SYN packets
tcpdump -i eth0 'tcp[tcpflags] & tcp-syn != 0'

# Capture packets larger than 1000 bytes
tcpdump -i eth0 'ip[2:2] > 1000'

# Capture between two hosts
tcpdump -i eth0 host 192.168.1.100 and host 192.168.1.200

# Capture with timestamp
tcpdump -i eth0 -tttt

# Rotate capture files
tcpdump -i eth0 -w capture.pcap -C 100 -W 10

# Capture with buffer size
tcpdump -i eth0 -B 4096 -w capture.pcap

HFT USE CASE: Capture FIX messages for debugging
EXAMPLE: tcpdump -i eth0 -s 0 -w fix.pcap port 9876

ONE-LINER: Capture 10k packets: tcpdump -i eth0 -c 10000 -w sample.pcap

SAFETY WARNING: Heavy traffic can fill disk quickly
PERFORMANCE IMPACT: 5-10% CPU overhead at 10Gbps


3.2 TCPDUMP ADVANCED FILTERS
-----------------------------

# Capture only SYN packets (connection attempts)
tcpdump -i eth0 'tcp[13] & 2 != 0'

# Capture only RST packets (connection resets)
tcpdump -i eth0 'tcp[13] & 4 != 0'

# Capture packets with data (PSH flag)
tcpdump -i eth0 'tcp[13] & 8 != 0'

# Capture retransmissions (rough filter)
tcpdump -i eth0 'tcp[tcpflags] & (tcp-syn|tcp-fin) == 0 and greater 0'

# Capture specific TCP flags
tcpdump -i eth0 'tcp[13] = 18'  # SYN-ACK

# Capture multicast
tcpdump -i eth0 multicast

# Capture broadcasts
tcpdump -i eth0 broadcast

# Exclude specific host
tcpdump -i eth0 not host 192.168.1.100

# Capture specific VLAN
tcpdump -i eth0 vlan 100

# Capture with snaplen optimization
tcpdump -i eth0 -s 96 -w capture.pcap  # Only capture headers

HFT USE CASE: Filter market data multicast
EXAMPLE: tcpdump -i eth0 -s 0 multicast and udp and port 15000


3.3 WIRESHARK / TSHARK (Detailed Analysis)
-------------------------------------------

# Capture with tshark (CLI Wireshark)
tshark -i eth0

# Write to file
tshark -i eth0 -w capture.pcapng

# Display specific fields
tshark -i eth0 -T fields -e frame.time -e ip.src -e ip.dst

# Filter by protocol
tshark -i eth0 -f "tcp port 8080"

# Read and filter file
tshark -r capture.pcap -Y "tcp.port == 8080"

# Export to CSV
tshark -r capture.pcap -T fields -E separator=, -e ip.src -e ip.dst -e tcp.port

# Show statistics
tshark -r capture.pcap -q -z conv,tcp

# Show packet rate
tshark -i eth0 -q -z io,stat,1

# Decode as specific protocol
tshark -i eth0 -d tcp.port==9876,fix

# Extract TCP stream
tshark -r capture.pcap -q -z follow,tcp,ascii,0

HFT USE CASE: Analyze FIX message timing
ONE-LINER: Extract timestamps: tshark -r fix.pcap -T fields -e frame.time -e fix.MsgType


3.4 NGREP (Network GREP)
-------------------------

# Search for pattern in packets
ngrep -q 'FIX.4.4' -d eth0

# Search with regex
ngrep -q '^GET|^POST' port 80

# Case insensitive
ngrep -qi 'password' -d eth0

# Show timestamp
ngrep -qt 'ERROR' -d eth0

# Match specific port
ngrep port 8080

# Save to file
ngrep -q 'pattern' -d eth0 -O capture.txt

HFT USE CASE: Real-time monitoring of FIX messages
EXAMPLE: ngrep -q 'MsgType=D' -d eth0 port 9876


================================================================================
4. NETWORK PERFORMANCE TESTING
================================================================================

4.1 IPERF3 (Bandwidth Testing)
-------------------------------

# Server mode
iperf3 -s

# Client mode
iperf3 -c 192.168.1.100

# Test for 60 seconds
iperf3 -c 192.168.1.100 -t 60

# Use multiple streams
iperf3 -c 192.168.1.100 -P 4

# UDP test
iperf3 -c 192.168.1.100 -u -b 1G

# Reverse mode (server sends)
iperf3 -c 192.168.1.100 -R

# Bidirectional test
iperf3 -c 192.168.1.100 --bidir

# JSON output
iperf3 -c 192.168.1.100 -J

# Set TCP window size
iperf3 -c 192.168.1.100 -w 256K

# Test with specific MSS
iperf3 -c 192.168.1.100 -M 1460

HFT USE CASE: Validate 10G network performance
EXPECTED: 9.5+ Gbps for 10G link, <1ms latency


4.2 NETPERF (Network Benchmarking)
-----------------------------------

# TCP stream test
netperf -H 192.168.1.100 -t TCP_STREAM

# TCP request/response (latency)
netperf -H 192.168.1.100 -t TCP_RR

# UDP stream
netperf -H 192.168.1.100 -t UDP_STREAM

# Set test duration
netperf -H 192.168.1.100 -l 60

# Set message size
netperf -H 192.168.1.100 -t TCP_RR -- -r 64,64

# Multiple connections
netperf -H 192.168.1.100 -t TCP_RR -P 4

# Show confidence intervals
netperf -H 192.168.1.100 -t TCP_RR -I 99,5

HFT USE CASE: Measure request/response latency
EXPECTED: < 50μs for same-rack servers


4.3 SOCKPERF (Socket Performance)
----------------------------------

# Server mode
sockperf server -i 192.168.1.100 -p 12345

# Ping-pong test
sockperf ping-pong -i 192.168.1.100 -p 12345 -t 60

# Throughput test
sockperf throughput -i 192.168.1.100 -p 12345 -t 60

# Playback test
sockperf playback -i 192.168.1.100 -p 12345 --mps=100000

# Under load
sockperf under-load -i 192.168.1.100 -p 12345 --mps=50000

# Full log
sockperf ping-pong -i 192.168.1.100 -p 12345 --full-log=latency.csv

HFT USE CASE: Measure microsecond-level latency
EXPECTED: < 10μs for low-latency network


4.4 QPERF (RDMA and Network Testing)
-------------------------------------

# Start server
qperf

# TCP bandwidth test
qperf 192.168.1.100 tcp_bw

# TCP latency test
qperf 192.168.1.100 tcp_lat

# UDP tests
qperf 192.168.1.100 udp_bw udp_lat

# RDMA tests (if available)
qperf 192.168.1.100 rc_bw rc_lat

# Multiple tests
qperf 192.168.1.100 tcp_bw tcp_lat udp_bw udp_lat

HFT USE CASE: Validate low-latency network setup


================================================================================
5. SOCKET AND CONNECTION MANAGEMENT
================================================================================

5.1 SOCAT (Socket CAT)
-----------------------

# TCP port forwarding
socat TCP-LISTEN:8080,fork TCP:192.168.1.100:80

# UDP relay
socat UDP-LISTEN:5000,fork UDP:192.168.1.100:5000

# Unix socket to TCP
socat UNIX-LISTEN:/tmp/socket,fork TCP:192.168.1.100:8080

# SSL/TLS proxy
socat TCP-LISTEN:8443,fork,reuseaddr OPENSSL:server.com:443

# Connect to TCP socket
echo "test" | socat - TCP:192.168.1.100:8080

# Multicast sender
socat - UDP-DATAGRAM:239.255.0.1:1234,bind=:1234

# Multicast receiver
socat UDP-RECV:1234,ip-add-membership=239.255.0.1:eth0 -

HFT USE CASE: Test market data feeds
EXAMPLE: socat UDP-RECV:15000,ip-add-membership=224.0.0.1:eth0 -


5.2 NETCAT (nc)
---------------

# Listen on port
nc -l 8080

# Connect to port
nc 192.168.1.100 8080

# UDP mode
nc -u 192.168.1.100 5000

# Port scanning
nc -zv 192.168.1.100 1-1000

# Transfer file
nc -l 8080 > file.txt  # receiver
nc 192.168.1.100 8080 < file.txt  # sender

# Chat between servers
nc -l 8080  # server
nc 192.168.1.100 8080  # client

# Test if port is open
nc -zv 192.168.1.100 8080

# Set timeout
nc -w 5 192.168.1.100 8080

HFT USE CASE: Quick test of exchange connectivity
EXAMPLE: nc -zv exchange.com 9876


5.3 LSOF (Network Connections)
-------------------------------

# Show network connections
lsof -i

# Show specific port
lsof -i :8080

# Show TCP connections
lsof -i tcp

# Show UDP connections
lsof -i udp

# Show IPv4 connections
lsof -i 4

# Show connections by process
lsof -p $(pidof trading_engine) -i

# Show listening sockets
lsof -i -sTCP:LISTEN

# Show established connections
lsof -i -sTCP:ESTABLISHED

# Show connections to specific host
lsof -i @192.168.1.100

HFT USE CASE: Verify FIX session connections
ONE-LINER: lsof -i -a -p $(pidof app) | grep ESTABLISHED


================================================================================
6. NETWORK INTERFACE TUNING
================================================================================

6.1 TUNING SCRIPT FOR LOW LATENCY
----------------------------------

#!/bin/bash
# Network interface optimization for HFT

INTERFACE="eth0"

echo "Optimizing $INTERFACE for low latency..."

# Disable offloading
ethtool -K $INTERFACE tso off
ethtool -K $INTERFACE gso off
ethtool -K $INTERFACE gro off
ethtool -K $INTERFACE lro off
ethtool -K $INTERFACE sg off
ethtool -K $INTERFACE rx-checksumming off
ethtool -K $INTERFACE tx-checksumming off

# Disable interrupt coalescing
ethtool -C $INTERFACE adaptive-rx off adaptive-tx off
ethtool -C $INTERFACE rx-usecs 0 tx-usecs 0

# Increase ring buffers
ethtool -G $INTERFACE rx 4096 tx 4096

# Set IRQ affinity
for irq in $(grep $INTERFACE /proc/interrupts | awk -F: '{print $1}'); do
    echo 2 > /proc/irq/$irq/smp_affinity_list
done

# Disable pause frames
ethtool -A $INTERFACE rx off tx off

echo "Optimization complete"


6.2 INTERFACE STATISTICS MONITORING
------------------------------------

# Show interface statistics
cat /proc/net/dev

# Show detailed statistics
ip -s link show eth0

# Monitor packet drops
watch -n 1 'ethtool -S eth0 | grep -E "drop|error|miss"'

# Check ring buffer usage
ethtool -g eth0

HFT USE CASE: Monitor for packet drops during market open


================================================================================
7. TRAFFIC CONTROL AND QoS
================================================================================

7.1 TC (Traffic Control)
-------------------------

# Show current qdiscs
tc qdisc show dev eth0

# Add pfifo_fast qdisc (default)
tc qdisc add dev eth0 root pfifo_fast

# Add tbf (token bucket filter) rate limiting
tc qdisc add dev eth0 root tbf rate 1gbit burst 32kbit latency 50ms

# Add htb (hierarchical token bucket)
tc qdisc add dev eth0 root handle 1: htb default 10
tc class add dev eth0 parent 1: classid 1:1 htb rate 10gbit
tc class add dev eth0 parent 1:1 classid 1:10 htb rate 1gbit ceil 10gbit

# Add filter
tc filter add dev eth0 protocol ip parent 1:0 prio 1 u32 match ip dport 8080 0xffff flowid 1:10

# Show classes
tc class show dev eth0

# Show filters
tc filter show dev eth0

# Delete qdisc
tc qdisc del dev eth0 root

# Add delay (testing)
tc qdisc add dev eth0 root netem delay 100ms

# Add packet loss (testing)
tc qdisc add dev eth0 root netem loss 1%

HFT USE CASE: Prioritize trading traffic over management
EXAMPLE: tc filter add dev eth0 protocol ip prio 1 u32 match ip dport 9876 0xffff flowid 1:1


================================================================================
8. TROUBLESHOOTING WORKFLOWS
================================================================================

8.1 CONNECTION TROUBLESHOOTING
-------------------------------

# Step 1: Check interface is up
ip link show eth0 | grep "state UP"

# Step 2: Check IP configuration
ip addr show eth0

# Step 3: Check routing
ip route get <destination>

# Step 4: Test connectivity
ping -c 5 <destination>

# Step 5: Check firewall
iptables -L -n -v

# Step 6: Check port is listening
ss -tln | grep :8080

# Step 7: Test connection
telnet <host> <port>

# Step 8: Capture packets
tcpdump -i eth0 -n host <destination>


8.2 LATENCY TROUBLESHOOTING
----------------------------

# Check for packet drops
ethtool -S eth0 | grep drop

# Check interrupt rate
cat /proc/interrupts | grep eth0

# Check IRQ affinity
cat /proc/irq/*/smp_affinity_list

# Check network buffer usage
ss -tm

# Check for retransmissions
netstat -s | grep retrans

# Check MTU path
tracepath <destination>


================================================================================
BEST PRACTICES FOR HFT NETWORKS
================================================================================

1. Interface Configuration
   - Disable all offloading for consistent latency
   - Use jumbo frames (MTU 9000) where possible
   - Pin interrupts to specific CPUs
   - Increase ring buffer sizes

2. Monitoring
   - Continuous packet drop monitoring
   - Latency monitoring every second
   - Alert on any retransmissions
   - Track interrupt rates

3. Testing
   - Regular bandwidth tests
   - Latency testing under load
   - Failover testing
   - Path redundancy verification

4. Optimization
   - Use kernel bypass (DPDK) for ultra-low latency
   - Consider RDMA for datacenter networks
   - Optimize sysctl parameters
   - Use SR-IOV for virtualized environments

5. Troubleshooting
   - Always capture packets during issues
   - Maintain baseline metrics
   - Document network topology
   - Have rollback procedures

================================================================================
Last Updated: 2025-01-25
Version: 2.0
Maintainer: HFT Engineering Team
================================================================================

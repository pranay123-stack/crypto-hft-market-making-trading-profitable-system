================================================================================
BIOS SETTINGS FOR HFT OPTIMIZATION
================================================================================

OVERVIEW:
BIOS/UEFI configuration is the foundation of system optimization. Incorrect
BIOS settings can introduce latency, jitter, and unpredictable behavior that
cannot be fixed at the OS level. This document provides comprehensive BIOS
tuning guidance for ultra-low latency HFT systems.

TARGET IMPACT:
- Eliminate power management latency (C-states: 100-1000+ us)
- Remove CPU frequency transitions (P-states: 10-100 us)
- Disable unnecessary features (reduce system complexity)
- Ensure deterministic hardware behavior
- Maximize CPU and memory performance

================================================================================
1. ACCESSING BIOS/UEFI
================================================================================

COMMON ACCESS METHODS:
----------------------------------------
During boot, press:
- Dell: F2 or F12
- HP: F10 or ESC
- Lenovo: F1 or F2
- Supermicro: DEL or F2
- ASUS: F2 or DEL
- Gigabyte: DEL
- MSI: DEL
- Intel: F2

UEFI Shell Access:
- Some systems: F11 or F12 for boot menu, then UEFI shell

Remote Management (Server Systems):
- Dell iDRAC: https://idrac-ip
- HP iLO: https://ilo-ip
- Supermicro IPMI: https://ipmi-ip
- Access virtual console for BIOS configuration

BIOS Update:
- Always update to latest stable BIOS before tuning
- Check vendor website for updates
- Use vendor tools for flashing (avoid Windows-based tools)
- Backup current BIOS settings before update
----------------------------------------

================================================================================
2. CPU POWER MANAGEMENT (CRITICAL)
================================================================================

C-STATES (MUST DISABLE FOR HFT):
----------------------------------------
Location: Advanced > CPU Configuration > CPU C-States
         or: Power Management > CPU C-State Control

Settings:
[DISABLED] C1E Support (C1 Enhanced)
[DISABLED] C3 Report
[DISABLED] C6 Report (C6/C6E)
[DISABLED] C7 Report (C7/C7s)
[DISABLED] C8 Report
[DISABLED] C10 Report (if present)
[DISABLED] Package C-State
[DISABLED] CPU C-State Limit → Set to "C0/C1" or "Disabled"
[DISABLED] Enhanced Halt State (C1E)

Why Disable:
- C1E: 10-20 microsecond wake-up latency
- C3: 50-100 microsecond wake-up latency
- C6: 100-1000 microsecond wake-up latency
- C7/C8: 1-10 millisecond wake-up latency
- Unpredictable and non-deterministic
- Causes jitter in trading response times

Verification in Linux:
cat /sys/devices/system/cpu/cpu0/cpuidle/state*/disable
# All should show "1" (disabled)
----------------------------------------

P-STATES / SPEED STEP:
----------------------------------------
Location: Advanced > CPU Configuration > Speed Step
         or: Power Management > Enhanced Intel SpeedStep

OPTION 1: Disable (Most Deterministic)
[DISABLED] Intel SpeedStep / AMD Cool'n'Quiet
[DISABLED] Turbo Mode / Turbo Boost
[SET] CPU Frequency → Maximum (e.g., 3.7 GHz)

Why: Eliminates frequency scaling latency (10-100 us transitions)
Result: CPU always runs at base frequency
Power: Maximum consumption, maximum heat

OPTION 2: Enable with Turbo (Higher Performance, Less Deterministic)
[ENABLED] Intel SpeedStep
[ENABLED] Turbo Mode / Turbo Boost
[SET] CPU Power Management → Performance
[SET] Energy Performance → Maximum Performance

Why: Allows burst performance with Turbo Boost
Caveat: Frequency can vary under thermal throttling
Requires: Excellent cooling solution
Verification: Monitor temperature and throttling

RECOMMENDATION FOR HFT:
- Disable for absolute determinism
- Enable Turbo only if cooling is excellent and sustained load is low
----------------------------------------

TURBO BOOST CONFIGURATION:
----------------------------------------
Location: Advanced > CPU Configuration > Turbo Mode

[DISABLED] Intel Turbo Boost Technology (for determinism)
          or
[ENABLED] Intel Turbo Boost Technology (for maximum performance)

If Enabled:
[SET] Turbo Boost Max Technology 3.0 → Enabled
[SET] Per-Core Turbo Ratios → All cores max turbo
[DISABLED] Turbo Boost Short Power Max → Unlimited
[DISABLED] Turbo Boost Power Limit → Unlimited

Verify No Throttling:
- Monitor: turbostat --interval 1
- All cores should maintain consistent frequency under load
- No thermal throttling (< 85°C)
----------------------------------------

HARDWARE P-STATES (HWP):
----------------------------------------
Location: Advanced > CPU Configuration > Hardware P-States

OPTION 1: Disable (Use OS Control)
[DISABLED] Hardware P-States (HWP)
Result: OS controls frequency via intel_pstate or acpi-cpufreq

OPTION 2: Enable in Performance Mode
[ENABLED] Hardware P-States
[SET] HWP EPP → Performance
[SET] HWP Autonomous → Disabled

RECOMMENDATION:
- Disable HWP and use OS-level frequency locking
- Or enable in Performance mode with OS override
----------------------------------------

================================================================================
3. MEMORY CONFIGURATION
================================================================================

MEMORY FREQUENCY:
----------------------------------------
Location: Advanced > Memory Configuration

[SET] Memory Frequency → Maximum Supported (e.g., DDR4-3200, DDR5-4800)
[SET] Memory Profile → XMP Profile 1 (for overclocked RAM)
[ENABLED] XMP (Extreme Memory Profile) / DOCP (AMD)
[SET] Memory Voltage → Per XMP spec or manual (e.g., 1.35V for DDR4-3200)

Verify:
- Ensure stable operation with memtest86+ (run overnight)
- Check bandwidth: mbw -n 100 1024
----------------------------------------

MEMORY POWER MANAGEMENT:
----------------------------------------
[DISABLED] Memory Power Down
[DISABLED] DDR Power Saving Mode
[DISABLED] Memory Patrol Scrub (optional, trades ECC scrubbing for latency)
[DISABLED] Memory Refresh Rate Throttling

[ENABLED] Memory Fast Boot (skip memory training)
[ENABLED] Memory XMP Profile
----------------------------------------

MEMORY TRAINING:
----------------------------------------
[SET] Memory Training Mode → Fast (after initial stable configuration)
      or: Thorough (during initial setup)

[DISABLED] Memory Retry (saves time on boot)
[ENABLED] Memory ECC (if using ECC memory)
[DISABLED] Memory Bank Interleaving (may increase latency, test both)

Note: Some BIOS options can improve memory latency at cost of capacity
----------------------------------------

================================================================================
4. HYPER-THREADING / SMT
================================================================================

SIMULTANEOUS MULTITHREADING (SMT):
----------------------------------------
Location: Advanced > CPU Configuration > Hyper-Threading

RECOMMENDATION FOR HFT: DISABLE

[DISABLED] Intel Hyper-Threading Technology
          or
[DISABLED] AMD SMT Mode

Why Disable:
- Eliminates cache and execution unit contention
- Reduces TLB conflicts
- Improves determinism
- Simplifies CPU affinity management
- Reduces power consumption

When to Keep Enabled:
- Need more logical CPUs than physical cores
- Workload is highly parallelizable
- Latency variance is acceptable

Verification:
lscpu | grep "Thread(s) per core"
# Should show: 1
----------------------------------------

================================================================================
5. PCIe AND BUS CONFIGURATION
================================================================================

PCIe LINK SPEED:
----------------------------------------
Location: Advanced > PCIe Configuration

[SET] PCIe Link Speed → Maximum (Gen 3 or Gen 4)
[DISABLED] PCIe ASPM (Active State Power Management)
[DISABLED] PCIe Clock Gating
[DISABLED] PCIe Speed Transition

For each PCIe slot:
[SET] PCIe Slot 1 → Gen4 x16 (or maximum supported)
[SET] PCIe Slot 2 → Gen4 x8
[DISABLED] PCIe Hot Plug Support

Verify:
lspci -vv | grep "LnkSta:"
# Should show maximum speed: Speed 16GT/s (Gen4) or 8GT/s (Gen3)
----------------------------------------

ASPM (MUST DISABLE):
----------------------------------------
[DISABLED] ASPM Support (Active State Power Management)
[DISABLED] L0s Entry
[DISABLED] L1 Entry
[DISABLED] L1 Sub-States

Why: ASPM introduces PCIe link power saving states with wake-up latency

Kernel Parameter (additional safety):
pcie_aspm=off
----------------------------------------

PCIe ERROR REPORTING:
----------------------------------------
[ENABLED] PCIe AER (Advanced Error Reporting) - for diagnostics
[ENABLED] PCIe Error Injection Support (optional)

Can be disabled in production for minimal overhead:
[DISABLED] PCIe AER
----------------------------------------

================================================================================
6. CHIPSET AND DEVICE CONFIGURATION
================================================================================

SATA CONFIGURATION:
----------------------------------------
Location: Advanced > SATA Configuration

[SET] SATA Mode → AHCI (not RAID or IDE)
[ENABLED] SATA Hot Plug (optional, if using hot-swappable drives)
[ENABLED] SATA Aggressive Link Power Management → Disabled

For each SATA port:
[ENABLED] SATA Port X (only enable ports in use)
[DISABLED] SATA Port Multiplier
----------------------------------------

USB CONFIGURATION:
----------------------------------------
Location: Advanced > USB Configuration

[DISABLED] Legacy USB Support (unless needed for keyboard/mouse)
[DISABLED] USB 3.0/3.1 (if not used)
[DISABLED] USB Charging in S5 (power off)
[DISABLED] USB Smart Auto Mode

Enable only if needed:
[ENABLED] USB 2.0 Controller (for keyboard/mouse)

Disable unused USB ports:
[DISABLED] USB Port X (for all unused ports)
----------------------------------------

AUDIO:
----------------------------------------
Location: Advanced > Audio Configuration

[DISABLED] HD Audio Controller (unless needed)
[DISABLED] Front Panel Audio

Why: Reduces interrupt overhead and system complexity
----------------------------------------

ONBOARD DEVICES:
----------------------------------------
Location: Advanced > Onboard Devices

Disable all unnecessary devices:
[DISABLED] Onboard LAN Controller (if using PCIe NIC)
[DISABLED] Onboard Audio
[DISABLED] Onboard WiFi
[DISABLED] Onboard Bluetooth
[DISABLED] Onboard Serial Port
[DISABLED] Onboard Parallel Port
[DISABLED] Onboard IEEE 1394 (FireWire)

Enable only required devices:
[ENABLED] Management LAN (for IPMI/iDRAC)
[ENABLED] Primary NIC (if using onboard for trading)
----------------------------------------

================================================================================
7. SYSTEM AGENT CONFIGURATION
================================================================================

VT-d / IOMMU:
----------------------------------------
Location: Advanced > System Agent > VT-d

RECOMMENDATION: DISABLE (unless using virtualization or kernel bypass)

[DISABLED] Intel VT-d / AMD-Vi (IOMMU)

Why Disable:
- Reduces DMA latency
- Eliminates IOMMU translation overhead
- Simpler memory access path

When to Enable:
- Using SR-IOV
- Using DPDK with VFIO driver
- Running VMs (not recommended for bare-metal HFT)

Kernel Parameter:
intel_iommu=off iommu=off
----------------------------------------

VIRTUALIZATION:
----------------------------------------
Location: Advanced > CPU Configuration

[DISABLED] Intel Virtualization Technology (VT-x)
[DISABLED] AMD-V

Why: Reduces overhead, not needed for bare-metal HFT

If running VMs:
[ENABLED] Intel VT-x / AMD-V
[ENABLED] Intel VT-d / AMD-Vi
[ENABLED] SR-IOV Support
----------------------------------------

================================================================================
8. POWER MANAGEMENT
================================================================================

GLOBAL POWER SETTINGS:
----------------------------------------
Location: Power or Advanced > Power Management

[SET] Power Profile → Performance or Maximum Performance
[SET] Energy Performance → Performance
[DISABLED] Dynamic Power Technology
[DISABLED] Low Power Mode
[DISABLED] Extended Idle Power States

[DISABLED] Processor Power State C0
[SET] Processor Power Management → Disabled or Maximum Performance
----------------------------------------

ACPI SETTINGS:
----------------------------------------
Location: Advanced > ACPI Settings

[DISABLED] ACPI S3 (Suspend to RAM)
[DISABLED] ACPI S4 (Hibernate)
[SET] ACPI S5 → Soft Off (OS shutdown)

[DISABLED] Wake on LAN (unless required)
[DISABLED] Wake on RTC (Real-Time Clock)
[DISABLED] Wake on PME
----------------------------------------

FAN CONTROL:
----------------------------------------
Location: Advanced > Hardware Monitor or Fan Control

[SET] CPU Fan → Maximum Speed or Manual 100%
[SET] System Fan → Maximum Speed or Manual 100%
[SET] Chassis Fan → Maximum Speed or Manual 100%

[DISABLED] Smart Fan Control (eliminate thermal-based speed variation)
[DISABLED] Q-Fan Control
[DISABLED] SpeedStep for Fans

Why: Maintain consistent cooling, prevent thermal throttling

Verify: CPU temperature should remain < 75°C under full load
----------------------------------------

================================================================================
9. BOOT CONFIGURATION
================================================================================

BOOT OPTIONS:
----------------------------------------
Location: Boot or Boot Settings

[SET] Boot Mode → UEFI (not Legacy/CSM)
[SET] Boot Order → NVMe/SSD first, then network
[DISABLED] Network Boot (PXE) - unless required
[DISABLED] Quick Boot / Fast Boot (can hide issues)
[ENABLED] Full Screen Logo → Disabled (see boot messages)

[SET] Boot Timeout → 3 seconds (minimal delay)
[DISABLED] Wait for F1 if Error
[ENABLED] Halt on Errors → Disabled (don't pause on minor errors)
----------------------------------------

SECURE BOOT:
----------------------------------------
Location: Boot > Secure Boot

RECOMMENDATION: DISABLE (for Linux and custom kernels)

[DISABLED] Secure Boot

Why: Can interfere with custom kernel modules and drivers

If required for security policy:
[ENABLED] Secure Boot
[SET] Secure Boot Mode → Custom
[ADD] Keys for Linux distribution
----------------------------------------

================================================================================
10. LEGACY FEATURES (DISABLE ALL)
================================================================================

LEGACY DEVICE SUPPORT:
----------------------------------------
[DISABLED] CSM (Compatibility Support Module)
[DISABLED] Legacy Option ROM
[DISABLED] Legacy USB Support (unless needed for boot)
[DISABLED] Legacy OPROM
[DISABLED] Serial Port
[DISABLED] Parallel Port
[DISABLED] Floppy Disk Controller
[DISABLED] PS/2 Emulation

Why: Remove unnecessary legacy device initialization and overhead
----------------------------------------

================================================================================
11. BIOS SECURITY (CONFIGURE AFTER TUNING)
================================================================================

SECURITY SETTINGS:
----------------------------------------
Location: Security

[SET] Administrator Password → Set strong password
[SET] User Password → Optionally set
[ENABLED] Password on Boot → Optional

[DISABLED] Chassis Intrusion (can cause boot issues)
[ENABLED] Secure Firmware Update → Enabled
[ENABLED] TPM (Trusted Platform Module) → Optional

[DISABLED] Intel TXT (Trusted Execution Technology)
[DISABLED] Intel SGX (Software Guard Extensions)
----------------------------------------

================================================================================
12. VENDOR-SPECIFIC OPTIMIZATIONS
================================================================================

SUPERMICRO:
----------------------------------------
Advanced > CPU Configuration:
[DISABLED] C-State Package Limit
[DISABLED] CPU C6 Report
[DISABLED] Enhanced Halt State
[DISABLED] MLC Streamer Prefetcher
[DISABLED] MLC Spatial Prefetcher
[DISABLED] DCU Streamer Prefetcher
[DISABLED] DCU IP Prefetcher

Note: Disabling prefetchers can reduce latency variance
Test both enabled/disabled for your workload
----------------------------------------

DELL POWEREDGE:
----------------------------------------
System Setup > System BIOS > Processor Settings:
[DISABLED] C States
[DISABLED] C1E
[SET] Logical Processor → Disabled (if disabling HT)

System Setup > System BIOS > Integrated Devices:
[DISABLED] Internal USB Port
[DISABLED] Embedded NIC (if using PCIe)
[DISABLED] OS Watchdog Timer

iDRAC Settings:
[SET] iDRAC Priority → Low (don't interfere with OS)
----------------------------------------

HP PROLIANT:
----------------------------------------
System Options > Processor Options:
[DISABLED] Intel Hyperthreading Options
[DISABLED] Intel Turbo Boost Technology
[DISABLED] Minimum Processor Idle Power Core C-State

System Options > Power Management:
[SET] Power Profile → Maximum Performance
[SET] Collaborative Power Control → Disabled
[SET] Intel Dynamic Power Capping → Disabled
----------------------------------------

================================================================================
13. VALIDATION AND VERIFICATION
================================================================================

POST-CONFIGURATION VERIFICATION:
----------------------------------------
1. Boot into system successfully
2. Check dmesg for errors:
   dmesg | grep -i error

3. Verify CPU frequency:
   grep MHz /proc/cpuinfo

4. Verify C-states disabled:
   cat /sys/devices/system/cpu/cpu*/cpuidle/state*/disable

5. Verify SMT disabled:
   lscpu | grep "Thread(s) per core"

6. Verify PCIe speeds:
   lspci -vv | grep "LnkSta:"

7. Check BIOS settings persistence:
   Reboot and re-enter BIOS to confirm all settings retained

8. Run latency benchmark:
   cyclictest -p 99 -t 1 -n -m -i 200 -l 100000
----------------------------------------

BIOS SETTINGS EXPORT:
----------------------------------------
# Some BIOS allow settings export (Supermicro, Dell, HP)
# Supermicro: Save to USB via BIOS utility
# Dell: syscfg --file=bios_settings.cfg
# HP: conrep -s -f bios_settings.dat

# Document all changes in configuration management
# Create baseline document with screenshots
----------------------------------------

================================================================================
14. BIOS OPTIMIZATION CHECKLIST
================================================================================

CPU POWER MANAGEMENT:
[ ] All C-States disabled (C1E, C3, C6, C7, C8)
[ ] Package C-State disabled
[ ] CPU C-State Limit set to C0/C1
[ ] P-States/SpeedStep configured (disabled or performance)
[ ] Turbo Boost configured per requirements
[ ] Hardware P-States (HWP) disabled or set to performance

CPU CONFIGURATION:
[ ] Hyper-Threading disabled (for determinism)
[ ] CPU frequency locked to maximum
[ ] Prefetchers configured (test enabled vs disabled)
[ ] Performance monitoring enabled (optional)

MEMORY:
[ ] Memory frequency set to maximum
[ ] XMP profile enabled (if using overclocked RAM)
[ ] Memory power management disabled
[ ] Memory training set appropriately
[ ] ECC enabled (if using ECC RAM)

PCIe AND BUS:
[ ] PCIe speed set to maximum (Gen3/Gen4)
[ ] ASPM disabled globally
[ ] PCIe clock gating disabled
[ ] SATA mode set to AHCI
[ ] PCIe AER enabled (for diagnostics)

DEVICES:
[ ] Unnecessary onboard devices disabled
[ ] USB configuration minimized
[ ] Audio disabled (if not needed)
[ ] Serial/Parallel ports disabled
[ ] Legacy devices disabled

POWER:
[ ] Power profile set to maximum performance
[ ] Dynamic power technology disabled
[ ] ACPI sleep states disabled
[ ] Fan control set to maximum cooling

BOOT:
[ ] Boot mode set to UEFI
[ ] Boot order optimized
[ ] Fast boot disabled (see all messages)
[ ] Secure boot configured per policy

VIRTUALIZATION:
[ ] VT-x/AMD-V disabled (unless needed)
[ ] VT-d/AMD-Vi disabled (unless needed)
[ ] SR-IOV disabled (unless needed)

SECURITY:
[ ] Administrator password set
[ ] Firmware update secured
[ ] TPM configured per policy

VERIFICATION:
[ ] System boots successfully
[ ] All settings verified in OS
[ ] Latency benchmarks passing
[ ] No errors in dmesg
[ ] Settings documented and backed up
[ ] Configuration persistent across reboots

================================================================================
15. TROUBLESHOOTING
================================================================================

SYSTEM WON'T BOOT:
- Reset CMOS (remove battery or use jumper)
- Try less aggressive settings (enable C-states, SMT)
- Update BIOS to latest version
- Check memory compatibility

THERMAL THROTTLING:
- Verify fan settings (should be 100%)
- Check thermal paste application
- Verify heatsink mounting
- Consider better cooling solution
- Re-evaluate Turbo Boost settings

INTERMITTENT ISSUES:
- Verify memory stability (memtest86+)
- Check power supply adequacy
- Monitor system logs for hardware errors
- Verify PCIe device compatibility

================================================================================
END OF DOCUMENT
================================================================================

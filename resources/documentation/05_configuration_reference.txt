================================================================================
HFT SYSTEM CONFIGURATION REFERENCE
================================================================================

VERSION: 1.0
LAST UPDATED: 2025-11-25
OWNER: Platform Engineering Team
CLASSIFICATION: Internal Use Only

================================================================================
TABLE OF CONTENTS
================================================================================

1. CONFIGURATION OVERVIEW
2. SYSTEM CONFIGURATION
3. EXCHANGE CONFIGURATIONS
4. STRATEGY CONFIGURATIONS
5. RISK MANAGEMENT CONFIGURATION
6. PERFORMANCE TUNING CONFIGURATION
7. LOGGING CONFIGURATION
8. MONITORING CONFIGURATION
9. DATABASE CONFIGURATION
10. NETWORK CONFIGURATION
11. SECURITY CONFIGURATION
12. ENVIRONMENT-SPECIFIC CONFIGURATIONS

================================================================================
1. CONFIGURATION OVERVIEW
================================================================================

1.1 CONFIGURATION FILES
-----------------------

Primary Configuration:
/opt/hft_system/config/production.json     - Production settings
/opt/hft_system/config/development.json    - Development settings
/opt/hft_system/config/staging.json        - Staging environment

Exchange Configurations:
/opt/hft_system/config/exchanges/*.json    - Per-exchange settings

Strategy Configurations:
/opt/hft_system/config/strategies/*.json   - Per-strategy settings

Risk Configuration:
/opt/hft_system/config/risk_limits.json    - Risk management rules

1.2 CONFIGURATION HIERARCHY
----------------------------

Environment Variable > Config File > Default Value

Example:
HFT_LOG_LEVEL=DEBUG     (highest priority)
  ↓
config.logging.level    (medium priority)
  ↓
INFO                    (default, lowest priority)

1.3 CONFIGURATION VALIDATION
-----------------------------

Validate configuration before starting:
```bash
./bin/hft_system --validate-config --config=config/production.json
```

Expected output:
```
Configuration validation: PASSED
- System configuration: OK
- Exchange configurations: OK (10 exchanges)
- Strategy configurations: OK (5 strategies)
- Risk limits: OK
- Database connection: OK
- Network settings: OK
```

1.4 HOT RELOAD
--------------

Most configuration changes can be applied without restart:
```bash
curl -X GET http://localhost:8080/api/v1/config/reload
```

Changes requiring restart:
- Thread pool sizes
- Port bindings
- Database connection string
- Memory allocation settings

================================================================================
2. SYSTEM CONFIGURATION
================================================================================

2.1 MAIN CONFIGURATION STRUCTURE
---------------------------------

File: config/production.json

```json
{
  "system": {
    "node_id": "hft-prod-01",
    "role": "primary",
    "environment": "production",
    "log_level": "INFO",
    "trading_enabled": true
  },
  "networking": {
    "api_port": 8080,
    "api_ssl_port": 8443,
    "websocket_port": 8081,
    "websocket_ssl_port": 8444,
    "ssl_certificate": "/etc/ssl/certs/hft_system.crt",
    "ssl_private_key": "/etc/ssl/private/hft_system.key"
  },
  "threading": {
    "market_data_threads": 10,
    "order_threads": 4,
    "strategy_threads": 8,
    "io_threads": 4,
    "thread_affinity_enabled": true,
    "thread_affinity": {
      "market_data": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
      "order": [10, 11, 12, 13],
      "strategy": [14, 15, 16, 17, 18, 19, 20, 21],
      "io": [22, 23, 24, 25]
    }
  },
  "memory": {
    "pre_allocate_mb": 8192,
    "use_huge_pages": true,
    "lock_memory": true,
    "order_book_max_depth": 100,
    "order_history_retention_hours": 24
  },
  "performance": {
    "enable_profiling": false,
    "enable_latency_tracking": true,
    "latency_sample_rate": 1.0,
    "batch_size": 100,
    "queue_size": 100000
  },
  "database": {
    "host": "localhost",
    "port": 5432,
    "database": "hft_db",
    "user": "hft_user",
    "password_env": "DB_PASSWORD",
    "connection_pool_size": 20,
    "connection_timeout_ms": 5000,
    "query_timeout_ms": 30000
  },
  "exchanges": [
    "binance",
    "coinbase",
    "kraken",
    "okx",
    "bybit",
    "huobi",
    "kucoin",
    "bitfinex",
    "deribit",
    "kraken_futures"
  ],
  "strategies": [
    "market_maker_btc",
    "market_maker_eth",
    "arbitrage_cross_exchange",
    "arbitrage_triangular",
    "stat_arb_pairs"
  ],
  "monitoring": {
    "prometheus_port": 9090,
    "metrics_export_interval_ms": 1000,
    "health_check_interval_ms": 60000
  },
  "failover": {
    "heartbeat_interval_ms": 1000,
    "heartbeat_timeout_ms": 3000,
    "enable_auto_failover": true,
    "standby_node": "hft-prod-02"
  }
}
```

2.2 PARAMETER DESCRIPTIONS
---------------------------

system.node_id (string)
- Description: Unique identifier for this node
- Valid values: Any alphanumeric string
- Example: "hft-prod-01"

system.role (string)
- Description: Node role in cluster
- Valid values: "primary", "standby", "development"
- Default: "standalone"

system.environment (string)
- Description: Deployment environment
- Valid values: "production", "staging", "development"
- Affects: Logging verbosity, safety checks

system.trading_enabled (boolean)
- Description: Master switch for all trading
- Valid values: true, false
- Default: false
- Note: Must be explicitly enabled for trading

networking.api_port (integer)
- Description: HTTP API port
- Valid values: 1024-65535
- Default: 8080
- Requires restart: Yes

threading.market_data_threads (integer)
- Description: Number of threads for market data processing
- Valid values: 1-32
- Recommended: 1 per exchange
- Requires restart: Yes

threading.thread_affinity_enabled (boolean)
- Description: Pin threads to specific CPU cores
- Valid values: true, false
- Recommended: true for production (reduces context switching)
- Requires restart: Yes

memory.pre_allocate_mb (integer)
- Description: Memory to pre-allocate at startup (MB)
- Valid values: 1024-65536
- Recommended: 8192 for 10 exchanges
- Note: Reduces runtime allocations

memory.use_huge_pages (boolean)
- Description: Use 2MB huge pages for memory
- Valid values: true, false
- Recommended: true (reduces TLB misses)
- Prerequisite: System configured for huge pages

memory.order_book_max_depth (integer)
- Description: Maximum order book levels to maintain
- Valid values: 10-1000
- Default: 100
- Note: Higher values use more memory

performance.batch_size (integer)
- Description: Events to batch before processing
- Valid values: 1-1000
- Default: 100
- Trade-off: Higher = better throughput, higher latency

performance.queue_size (integer)
- Description: Maximum queue depth for lock-free queues
- Valid values: 1000-1000000
- Default: 100000
- Note: Must be power of 2 for some implementations

database.connection_pool_size (integer)
- Description: Number of database connections to maintain
- Valid values: 5-100
- Default: 20
- Trade-off: Higher = more concurrent queries, more resources

database.query_timeout_ms (integer)
- Description: Maximum time to wait for query (milliseconds)
- Valid values: 100-60000
- Default: 30000
- Note: Prevents hanging on slow queries

monitoring.metrics_export_interval_ms (integer)
- Description: How often to export metrics to Prometheus
- Valid values: 100-60000
- Default: 1000
- Trade-off: Lower = more accurate, higher overhead

failover.heartbeat_timeout_ms (integer)
- Description: Missing heartbeats before failover (milliseconds)
- Valid values: 1000-30000
- Default: 3000
- Note: 3 missed heartbeats = 3 seconds to failover

================================================================================
3. EXCHANGE CONFIGURATIONS
================================================================================

3.1 BINANCE CONFIGURATION
--------------------------

File: config/exchanges/binance.json

```json
{
  "exchange_id": "binance",
  "display_name": "Binance",
  "enabled": true,
  "environment": "production",

  "api": {
    "rest_endpoint": "https://api.binance.com",
    "websocket_endpoint": "wss://stream.binance.com:9443",
    "use_testnet": false,
    "testnet_rest": "https://testnet.binance.vision",
    "testnet_websocket": "wss://testnet.binance.vision"
  },

  "authentication": {
    "api_key_env": "BINANCE_API_KEY",
    "api_secret_env": "BINANCE_API_SECRET",
    "signature_method": "HMAC_SHA256"
  },

  "rate_limits": {
    "orders_per_second": 50,
    "requests_per_minute": 1200,
    "websocket_connections": 5,
    "weight_per_minute": 1200
  },

  "symbols": [
    {
      "symbol": "BTCUSDT",
      "enabled": true,
      "market_data": true,
      "trading": true,
      "tick_size": 0.01,
      "lot_size": 0.00001,
      "min_notional": 10.0
    },
    {
      "symbol": "ETHUSDT",
      "enabled": true,
      "market_data": true,
      "trading": true,
      "tick_size": 0.01,
      "lot_size": 0.0001,
      "min_notional": 10.0
    }
  ],

  "market_data": {
    "orderbook_depth": 20,
    "snapshot_interval_ms": 60000,
    "reconnect_delay_ms": 1000,
    "max_reconnect_delay_ms": 60000,
    "heartbeat_interval_ms": 30000
  },

  "trading": {
    "enabled": true,
    "paper_trading": false,
    "order_timeout_ms": 5000,
    "cancel_timeout_ms": 2000,
    "reconcile_interval_ms": 300000
  },

  "fees": {
    "maker_fee_bps": 10,
    "taker_fee_bps": 10,
    "use_bnb_for_fees": false
  }
}
```

3.2 EXCHANGE PARAMETER DESCRIPTIONS
------------------------------------

exchange_id (string)
- Unique identifier, must match filename
- Used in logs, metrics, APIs

enabled (boolean)
- Master switch for exchange
- false = all activity stopped

api.use_testnet (boolean)
- true = use testnet endpoints
- Recommended for development

rate_limits.orders_per_second (integer)
- Maximum order submissions per second
- System enforces locally to avoid exchange rate limits
- Set to 80% of exchange limit for safety margin

rate_limits.weight_per_minute (integer)
- Binance-specific: request weight limit
- Different endpoints cost different weights
- System tracks weight usage

symbols[].tick_size (float)
- Minimum price increment
- Prices must be multiples of tick_size
- Example: 0.01 means price like 50000.00, not 50000.001

symbols[].lot_size (float)
- Minimum quantity increment
- Quantities must be multiples of lot_size
- Example: 0.00001 BTC minimum

symbols[].min_notional (float)
- Minimum order value in quote currency
- Order must be >= min_notional
- Example: $10 minimum for BTCUSDT

market_data.snapshot_interval_ms (integer)
- How often to request full order book snapshot
- Protects against missing incremental updates
- Default: 60000 (1 minute)

trading.paper_trading (boolean)
- true = simulate orders, don't send to exchange
- Useful for testing strategies

trading.reconcile_interval_ms (integer)
- How often to reconcile positions with exchange
- Catches missed fills or errors
- Default: 300000 (5 minutes)

fees.maker_fee_bps (integer)
- Maker fee in basis points (1 bps = 0.01%)
- Used for P&L calculations
- Check exchange fee schedule

3.3 OTHER EXCHANGE TEMPLATES
-----------------------------

Coinbase (config/exchanges/coinbase.json):
```json
{
  "exchange_id": "coinbase",
  "api": {
    "rest_endpoint": "https://api.pro.coinbase.com",
    "websocket_endpoint": "wss://ws-feed.pro.coinbase.com"
  },
  "authentication": {
    "api_key_env": "COINBASE_API_KEY",
    "api_secret_env": "COINBASE_API_SECRET",
    "api_passphrase_env": "COINBASE_PASSPHRASE",
    "signature_method": "HMAC_SHA256"
  },
  "rate_limits": {
    "public_requests_per_second": 10,
    "private_requests_per_second": 15
  },
  "symbols": [
    {
      "symbol": "BTC-USD",
      "tick_size": 0.01,
      "lot_size": 0.00000001,
      "min_size": 0.001
    }
  ]
}
```

Kraken (config/exchanges/kraken.json):
```json
{
  "exchange_id": "kraken",
  "api": {
    "rest_endpoint": "https://api.kraken.com",
    "websocket_endpoint": "wss://ws.kraken.com"
  },
  "authentication": {
    "api_key_env": "KRAKEN_API_KEY",
    "api_secret_env": "KRAKEN_API_SECRET",
    "signature_method": "HMAC_SHA512"
  },
  "rate_limits": {
    "counter_max": 15,
    "counter_decay_per_second": 0.33,
    "public_cost": 1,
    "private_cost": 0
  },
  "symbols": [
    {
      "symbol": "XBT/USD",
      "kraken_symbol": "XXBTZUSD",
      "tick_size": 0.1,
      "lot_size": 0.00000001,
      "min_order_size": 0.0001
    }
  ]
}
```

================================================================================
4. STRATEGY CONFIGURATIONS
================================================================================

4.1 MARKET MAKER STRATEGY
--------------------------

File: config/strategies/market_maker_btc.json

```json
{
  "strategy_id": "market_maker_btc",
  "strategy_type": "market_making",
  "display_name": "BTC Market Maker",
  "enabled": true,
  "auto_start": false,

  "exchanges": ["binance", "coinbase"],
  "symbols": ["BTC-USDT", "BTC-USD"],

  "parameters": {
    "spread_bps": 5,
    "order_size": 0.1,
    "max_position": 2.0,
    "skew_enabled": true,
    "skew_factor": 0.5,
    "min_edge_bps": 2,
    "quote_ttl_ms": 5000,
    "rehedge_threshold": 0.5,
    "inventory_target": 0.0
  },

  "risk_limits": {
    "max_position_usd": 100000.00,
    "max_order_size_usd": 10000.00,
    "max_daily_loss_usd": 5000.00,
    "max_drawdown_usd": 10000.00
  },

  "execution": {
    "quote_both_sides": true,
    "cancel_on_signal": true,
    "smart_routing": false,
    "post_only": true,
    "reduce_only": false
  },

  "logging": {
    "log_level": "INFO",
    "log_signals": true,
    "log_orders": true,
    "log_fills": true
  }
}
```

4.2 STRATEGY PARAMETER DESCRIPTIONS
------------------------------------

parameters.spread_bps (float)
- Spread to quote around mid price (basis points)
- Example: 5 bps = 0.05% spread
- Trade-off: Wider spread = safer but less fills

parameters.order_size (float)
- Size of each quote (in base currency)
- Example: 0.1 BTC per quote

parameters.max_position (float)
- Maximum inventory (base currency)
- Example: 2.0 BTC maximum long or short

parameters.skew_enabled (boolean)
- Adjust quotes based on inventory
- true = quote tighter on side to reduce inventory

parameters.skew_factor (float)
- How much to skew (0.0 to 1.0)
- Example: 0.5 = moderate skew

parameters.min_edge_bps (float)
- Minimum profit edge required
- Won't quote if can't make this much
- Example: 2 bps minimum

parameters.quote_ttl_ms (integer)
- Time to live for quotes (milliseconds)
- Cancel and requote after this time
- Prevents stale quotes

parameters.rehedge_threshold (float)
- Inventory level to trigger hedge
- Example: 0.5 = hedge when 50% of max position

parameters.inventory_target (float)
- Target inventory level
- 0.0 = neutral (no bias)
- Can be positive (long bias) or negative (short bias)

execution.post_only (boolean)
- true = only make liquidity (limit orders)
- false = can take liquidity (market orders)
- Recommended: true for maker fee rebates

execution.reduce_only (boolean)
- true = only allow position-reducing orders
- Useful for closing positions, not opening

4.3 ARBITRAGE STRATEGY
----------------------

File: config/strategies/arbitrage_cross_exchange.json

```json
{
  "strategy_id": "arbitrage_cross_exchange",
  "strategy_type": "arbitrage",
  "display_name": "Cross-Exchange Arbitrage",
  "enabled": true,

  "exchanges": ["binance", "coinbase", "kraken"],
  "symbols": ["BTC-USDT", "BTC-USD", "XBT/USD"],

  "parameters": {
    "min_profit_bps": 10,
    "order_size": 0.05,
    "max_position_per_exchange": 1.0,
    "execution_timeout_ms": 5000,
    "hedge_immediately": true,
    "allow_cross_currency": false
  },

  "risk_limits": {
    "max_position_usd": 50000.00,
    "max_leg_imbalance": 0.1,
    "max_daily_loss_usd": 2000.00
  },

  "fees": {
    "include_in_calculation": true,
    "buffer_bps": 2
  }
}
```

parameters.min_profit_bps (float)
- Minimum profit after fees to execute
- Example: 10 bps = 0.1% profit required

parameters.hedge_immediately (boolean)
- true = execute both legs simultaneously
- false = execute sequentially (riskier)

parameters.allow_cross_currency (boolean)
- true = allow BTC-USDT vs BTC-USD arbitrage
- Introduces FX risk

fees.buffer_bps (float)
- Additional buffer on top of fees
- Safety margin for fee calculation errors

4.4 STATISTICAL ARBITRAGE
--------------------------

File: config/strategies/stat_arb_pairs.json

```json
{
  "strategy_id": "stat_arb_pairs",
  "strategy_type": "statistical_arbitrage",
  "display_name": "Pairs Trading",
  "enabled": false,

  "pairs": [
    {
      "leg1": {"exchange": "binance", "symbol": "BTC-USDT"},
      "leg2": {"exchange": "binance", "symbol": "ETH-USDT"},
      "hedge_ratio": 15.0
    }
  ],

  "parameters": {
    "lookback_period": 1440,
    "entry_z_score": 2.0,
    "exit_z_score": 0.5,
    "stop_loss_z_score": 4.0,
    "position_size_usd": 10000.00,
    "rebalance_threshold": 0.05
  },

  "risk_limits": {
    "max_position_usd": 50000.00,
    "max_daily_loss_usd": 3000.00
  }
}
```

================================================================================
5. RISK MANAGEMENT CONFIGURATION
================================================================================

5.1 RISK LIMITS
---------------

File: config/risk_limits.json

```json
{
  "global_limits": {
    "max_total_exposure_usd": 500000.00,
    "max_daily_loss_usd": 20000.00,
    "max_weekly_loss_usd": 50000.00,
    "max_position_size_usd": 100000.00,
    "max_order_size_usd": 20000.00,
    "max_orders_per_second": 100,
    "max_cancels_per_second": 200
  },

  "per_exchange_limits": {
    "binance": {
      "max_exposure_usd": 100000.00,
      "max_position_size_usd": 50000.00,
      "max_order_size_usd": 10000.00
    },
    "coinbase": {
      "max_exposure_usd": 100000.00,
      "max_position_size_usd": 50000.00,
      "max_order_size_usd": 10000.00
    }
  },

  "per_symbol_limits": {
    "BTC-USDT": {
      "max_position_size": 5.0,
      "max_order_size": 1.0,
      "price_band_pct": 5.0
    },
    "ETH-USDT": {
      "max_position_size": 100.0,
      "max_order_size": 20.0,
      "price_band_pct": 10.0
    }
  },

  "circuit_breakers": {
    "daily_loss": {
      "enabled": true,
      "threshold_usd": 15000.00,
      "action": "stop_all_strategies"
    },
    "position_limit": {
      "enabled": true,
      "threshold_pct": 0.90,
      "action": "block_new_positions"
    },
    "market_volatility": {
      "enabled": true,
      "price_change_threshold_pct": 10.0,
      "window_seconds": 60,
      "action": "reduce_position_sizes"
    },
    "rapid_drawdown": {
      "enabled": true,
      "drawdown_threshold_usd": 5000.00,
      "window_seconds": 300,
      "action": "killswitch"
    }
  },

  "pre_trade_checks": {
    "check_balance": true,
    "check_position_limits": true,
    "check_order_size": true,
    "check_price_reasonability": true,
    "check_daily_loss": true,
    "check_rate_limits": true,
    "check_exchange_status": true
  },

  "price_validation": {
    "max_deviation_from_mid_pct": 5.0,
    "max_deviation_from_last_pct": 2.0,
    "require_recent_market_data_ms": 5000
  }
}
```

5.2 RISK PARAMETER DESCRIPTIONS
--------------------------------

global_limits.max_total_exposure_usd (float)
- Maximum total notional exposure across all positions
- Sum of abs(position_value) for all positions
- Hard limit, cannot be exceeded

circuit_breakers.daily_loss.action (string)
- Valid values:
  - "alert_only": Send alert but continue trading
  - "stop_new_orders": Block new orders, allow cancels
  - "stop_all_strategies": Stop all strategies
  - "killswitch": Emergency stop everything

circuit_breakers.market_volatility.price_change_threshold_pct (float)
- Trigger if price moves this much in window
- Example: 10% move in 60 seconds triggers circuit breaker

price_validation.max_deviation_from_mid_pct (float)
- Order price cannot be more than this far from mid
- Prevents fat finger errors
- Example: 5% = order at 5% above/below mid rejected

================================================================================
6. PERFORMANCE TUNING CONFIGURATION
================================================================================

6.1 LATENCY OPTIMIZATION
-------------------------

```json
{
  "latency_optimization": {
    "enable_busy_wait": true,
    "enable_cpu_pinning": true,
    "enable_numa_aware": true,
    "disable_frequency_scaling": true,
    "isolate_critical_cores": true,
    "isolated_cores": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
  },

  "network_tuning": {
    "tcp_nodelay": true,
    "tcp_quickack": true,
    "socket_priority": 7,
    "recv_buffer_size": 2097152,
    "send_buffer_size": 2097152
  },

  "memory_tuning": {
    "use_huge_pages": true,
    "huge_page_size_mb": 2,
    "lock_pages": true,
    "prefault_memory": true,
    "disable_transparent_huge_pages": false
  }
}
```

6.2 THROUGHPUT OPTIMIZATION
----------------------------

```json
{
  "throughput_optimization": {
    "enable_batching": true,
    "batch_size": 100,
    "batch_timeout_us": 1000,
    "enable_prefetching": true,
    "prefetch_distance": 8,
    "enable_simd": true
  },

  "concurrency": {
    "lock_free_queues": true,
    "queue_size": 131072,
    "enable_work_stealing": true,
    "max_spin_iterations": 1000
  }
}
```

================================================================================
7. LOGGING CONFIGURATION
================================================================================

7.1 LOG CONFIGURATION
---------------------

```json
{
  "logging": {
    "global_level": "INFO",
    "console": {
      "enabled": true,
      "level": "INFO",
      "format": "text",
      "colored": true
    },
    "file": {
      "enabled": true,
      "level": "DEBUG",
      "format": "json",
      "directory": "/var/log/hft_system",
      "rotation": {
        "max_size_mb": 100,
        "max_age_days": 30,
        "max_backups": 100,
        "compress": true
      }
    },
    "syslog": {
      "enabled": false,
      "level": "WARN",
      "facility": "local0",
      "tag": "hft_system"
    },
    "components": {
      "market_data": "INFO",
      "order_manager": "INFO",
      "risk_manager": "INFO",
      "strategies": "INFO",
      "exchanges": "DEBUG",
      "database": "WARN",
      "network": "INFO"
    },
    "sampling": {
      "enabled": false,
      "sample_rate": 0.01,
      "always_log_errors": true
    }
  }
}
```

Log Levels (from most to least verbose):
- TRACE: Extremely detailed, only for debugging
- DEBUG: Detailed debugging information
- INFO: Normal operational messages
- WARN: Warning messages, system continues
- ERROR: Error messages, requires attention
- CRITICAL: Critical errors, system may fail

================================================================================
8. MONITORING CONFIGURATION
================================================================================

8.1 PROMETHEUS CONFIGURATION
-----------------------------

File: /etc/prometheus/prometheus.yml

```yaml
global:
  scrape_interval: 1s
  evaluation_interval: 10s
  external_labels:
    cluster: 'hft_production'
    environment: 'prod'

scrape_configs:
  - job_name: 'hft_system'
    static_configs:
      - targets: ['localhost:8080']
    metrics_path: '/api/v1/metrics'
    scrape_interval: 1s
    scrape_timeout: 500ms

  - job_name: 'node_exporter'
    static_configs:
      - targets: ['localhost:9100']

  - job_name: 'postgres_exporter'
    static_configs:
      - targets: ['localhost:9187']

alerting:
  alertmanagers:
    - static_configs:
        - targets: ['localhost:9093']

rule_files:
  - '/etc/prometheus/alerts/*.yml'
```

8.2 ALERT RULES
---------------

File: /etc/prometheus/alerts/hft_alerts.yml

```yaml
groups:
  - name: hft_critical
    interval: 10s
    rules:
      - alert: ExchangeDisconnected
        expr: exchange_connection_status == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Exchange {{ $labels.exchange }} disconnected"
          description: "Connection to {{ $labels.exchange }} has been down for 30 seconds"

      - alert: HighLatency
        expr: order_latency_p99_microseconds > 1000
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High order latency detected"
          description: "P99 order latency is {{ $value }} microseconds"

      - alert: DailyLossLimit
        expr: daily_pnl_usd < -15000
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Daily loss limit approached"
          description: "Daily P&L is {{ $value }} USD"

      - alert: HighCPU
        expr: cpu_usage_percent > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage"
          description: "CPU usage is {{ $value }}%"
```

8.3 GRAFANA DASHBOARDS
-----------------------

Dashboard configuration stored in:
/var/lib/grafana/dashboards/hft_*.json

Key dashboards:
- System Health: Overall system status
- Trading Performance: P&L, fills, orders
- Market Data: Latency, events, order books
- Risk: Positions, exposure, violations
- Infrastructure: CPU, memory, network, disk

================================================================================
9. DATABASE CONFIGURATION
================================================================================

9.1 POSTGRESQL CONFIGURATION
-----------------------------

File: /etc/postgresql/14/main/postgresql.conf

```
# Connection Settings
max_connections = 200
shared_buffers = 16GB
effective_cache_size = 48GB
maintenance_work_mem = 2GB
work_mem = 64MB

# Write-Ahead Log
wal_level = replica
wal_buffers = 16MB
checkpoint_completion_target = 0.9
max_wal_size = 4GB

# Query Planning
random_page_cost = 1.1  # SSDs
effective_io_concurrency = 200

# Performance
synchronous_commit = off  # For high-throughput writes
full_page_writes = on
wal_compression = on

# Monitoring
shared_preload_libraries = 'pg_stat_statements'
track_activity_query_size = 2048
```

9.2 TIMESCALEDB CONFIGURATION
------------------------------

```sql
-- Enable TimescaleDB extension
CREATE EXTENSION IF NOT EXISTS timescaledb;

-- Create hypertables
SELECT create_hypertable('market_data_ticks', 'timestamp',
  chunk_time_interval => INTERVAL '1 hour');

SELECT create_hypertable('order_book_snapshots', 'timestamp',
  chunk_time_interval => INTERVAL '1 hour');

-- Compression policy
ALTER TABLE market_data_ticks SET (
  timescaledb.compress,
  timescaledb.compress_segmentby = 'exchange, symbol'
);

SELECT add_compression_policy('market_data_ticks', INTERVAL '7 days');

-- Retention policy
SELECT add_retention_policy('market_data_ticks', INTERVAL '90 days');

-- Continuous aggregates
CREATE MATERIALIZED VIEW market_data_1min
WITH (timescaledb.continuous) AS
SELECT
  time_bucket('1 minute', timestamp) AS bucket,
  exchange,
  symbol,
  first(price, timestamp) AS open,
  max(price) AS high,
  min(price) AS low,
  last(price, timestamp) AS close,
  sum(volume) AS volume
FROM market_data_ticks
GROUP BY bucket, exchange, symbol;
```

================================================================================
10. NETWORK CONFIGURATION
================================================================================

10.1 SYSTEM NETWORK SETTINGS
-----------------------------

File: /etc/sysctl.conf

```
# TCP Settings
net.ipv4.tcp_nodelay = 1
net.ipv4.tcp_low_latency = 1
net.ipv4.tcp_sack = 1
net.ipv4.tcp_timestamps = 1
net.ipv4.tcp_window_scaling = 1

# TCP Buffer Sizes
net.core.rmem_max = 134217728
net.core.wmem_max = 134217728
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864

# Connection Tracking
net.netfilter.nf_conntrack_max = 1000000
net.netfilter.nf_conntrack_tcp_timeout_established = 86400

# Kernel Network Stack
net.core.netdev_max_backlog = 5000
net.core.somaxconn = 1024

# IP Settings
net.ipv4.ip_local_port_range = 10000 65535
net.ipv4.tcp_max_syn_backlog = 8192
```

Apply with: `sudo sysctl -p`

10.2 FIREWALL RULES
-------------------

```bash
# Allow SSH
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# Allow HTTPS for exchange connections
iptables -A OUTPUT -p tcp --dport 443 -j ACCEPT
iptables -A OUTPUT -p tcp --dport 9443 -j ACCEPT
iptables -A OUTPUT -p tcp --dport 8443 -j ACCEPT

# Allow internal monitoring
iptables -A INPUT -s 10.0.0.0/24 -p tcp --dport 9090 -j ACCEPT
iptables -A INPUT -s 10.0.0.0/24 -p tcp --dport 3000 -j ACCEPT

# Block everything else inbound
iptables -A INPUT -j DROP
```

================================================================================
11. SECURITY CONFIGURATION
================================================================================

11.1 SSL/TLS CONFIGURATION
---------------------------

```json
{
  "ssl": {
    "enabled": true,
    "certificate_file": "/etc/ssl/certs/hft_system.crt",
    "private_key_file": "/etc/ssl/private/hft_system.key",
    "ca_bundle_file": "/etc/ssl/certs/ca-certificates.crt",
    "min_tls_version": "TLS1.3",
    "cipher_suites": [
      "TLS_AES_256_GCM_SHA384",
      "TLS_CHACHA20_POLY1305_SHA256",
      "TLS_AES_128_GCM_SHA256"
    ],
    "verify_peer": true,
    "verify_hostname": true
  }
}
```

11.2 API KEY CONFIGURATION
---------------------------

```json
{
  "api_keys": {
    "storage": "encrypted_database",
    "encryption_algorithm": "AES-256-GCM",
    "key_rotation_days": 90,
    "max_key_age_days": 365,
    "require_signature": true,
    "signature_algorithm": "HMAC-SHA256",
    "timestamp_tolerance_seconds": 5
  }
}
```

11.3 ACCESS CONTROL
-------------------

```json
{
  "access_control": {
    "enable_rbac": true,
    "roles": {
      "admin": ["read", "write", "trade", "configure", "manage_users"],
      "trader": ["read", "trade"],
      "readonly": ["read"]
    },
    "ip_whitelist": [
      "10.0.0.0/24",
      "192.168.1.0/24"
    ],
    "max_failed_attempts": 5,
    "lockout_duration_seconds": 300
  }
}
```

================================================================================
12. ENVIRONMENT-SPECIFIC CONFIGURATIONS
================================================================================

12.1 PRODUCTION ENVIRONMENT
----------------------------

```json
{
  "environment": "production",
  "trading_enabled": true,
  "log_level": "INFO",
  "enable_profiling": false,
  "paper_trading": false,
  "use_testnet": false,
  "auto_failover": true,
  "safety_checks": "strict"
}
```

12.2 STAGING ENVIRONMENT
-------------------------

```json
{
  "environment": "staging",
  "trading_enabled": true,
  "log_level": "DEBUG",
  "enable_profiling": true,
  "paper_trading": true,
  "use_testnet": true,
  "auto_failover": false,
  "safety_checks": "strict"
}
```

12.3 DEVELOPMENT ENVIRONMENT
-----------------------------

```json
{
  "environment": "development",
  "trading_enabled": false,
  "log_level": "TRACE",
  "enable_profiling": true,
  "paper_trading": true,
  "use_testnet": true,
  "auto_failover": false,
  "safety_checks": "relaxed"
}
```

================================================================================
CONFIGURATION VALIDATION
================================================================================

Validation Checklist:

□ All required fields present
□ Value types correct (string, number, boolean, array)
□ Numeric values within valid ranges
□ File paths exist and accessible
□ Environment variables defined
□ API keys encrypted and valid
□ Thread counts match available CPUs
□ Memory allocations within system limits
□ Port numbers not conflicting
□ Exchange symbols valid
□ Strategy parameters reasonable
□ Risk limits conservative

Validation Command:
```bash
./bin/hft_system --validate-config --config=config/production.json --verbose
```

================================================================================
CONTACT INFORMATION
================================================================================

Configuration Support:
- Email: platform-eng@company.com
- Slack: #hft-config
- Documentation: https://docs.company.com/hft/config

Emergency Configuration Issues:
- On-call: +1-555-0101
- PagerDuty: config-emergency@company.pagerduty.com

================================================================================
DOCUMENT REVISION HISTORY
================================================================================

Version    Date          Author              Changes
------------------------------------------------------------------------
1.0        2025-11-25    Platform Team       Initial configuration reference

================================================================================
END OF DOCUMENT
================================================================================

================================================================================
                              BYBIT EXCHANGE
                     COMPREHENSIVE API INTEGRATION GUIDE
================================================================================

EXCHANGE OVERVIEW
================================================================================

Name: Bybit
Website: https://www.bybit.com
API Documentation: https://bybit-exchange.github.io/docs/v5/intro
Founded: 2018
Headquarters: Dubai, UAE
Trading Volume: $5-10 billion daily (2024)
Global Rank: #5-7 by trading volume

HISTORY AND BACKGROUND:
-----------------------
Founded in 2018 by Ben Zhou, Bybit quickly became one of the fastest-growing
cryptocurrency derivatives exchanges. Known for its user-friendly interface
and competitive fee structure, Bybit has established itself as a major player
in the derivatives market.

Key Milestones:
- 2018: Launch with BTC perpetual contracts
- 2019: Expanded to ETH and other perpetuals
- 2020: Introduced USDT perpetual contracts
- 2021: Launched spot trading
- 2022: Unified Trading Account introduced
- 2023: NFT marketplace and Web3 expansion
- 2024: Global institutional expansion

REGULATORY STATUS:
------------------
- Registered in Dubai
- Licensed in multiple jurisdictions
- MSB registered with FinCEN (US)
- Enhanced compliance programs

MARKET POSITION:
----------------
- Top 5 derivatives exchange
- 400+ cryptocurrencies
- Industry-leading derivatives platform
- Strong retail and institutional presence
- Excellent liquidity across products

================================================================================
                            TRADING PAIRS AND MARKETS
================================================================================

SPOT TRADING:
-------------
- 400+ cryptocurrencies
- Major pairs: BTC/USDT, ETH/USDT, SOL/USDT
- Stablecoin pairs
- Innovative tokens

DERIVATIVES:
------------
Perpetual Contracts:
- USDT perpetual (linear)
- Inverse perpetual (coin-margined)
- Up to 100x leverage

Futures:
- Delivery contracts
- Quarterly and bi-quarterly

Options:
- BTC and ETH options
- European-style settlement

MARGIN TRADING:
---------------
- Unified Trading Account (UTA)
- Cross margin and portfolio margin
- Up to 10x leverage on spot

COPY TRADING:
-------------
- Follow professional traders
- Automated copying
- Risk management tools

================================================================================
                              API ARCHITECTURE
================================================================================

API TYPES:
----------

1. REST API (V5 - Current)
   Base URL: https://api.bybit.com
   Testnet: https://api-testnet.bybit.com
   - Market data
   - Trading
   - Account management
   - Position management

2. WebSocket API (V5)
   Mainnet Public: wss://stream.bybit.com/v5/public/spot
   Mainnet Private: wss://stream.bybit.com/v5/private
   Testnet: wss://stream-testnet.bybit.com/v5/public/spot

3. AWS Support
   Multiple regions available for lower latency

API VERSIONS:
-------------
- V5 API (Current) - Unified Trading Account
- V3 API (Legacy) - Being phased out
- Recommendations: Use V5 for all new integrations

TESTNET:
--------
Full-featured testnet available at https://testnet.bybit.com
- Free test funds
- Same API structure as production
- Ideal for development and testing

================================================================================
                       API KEY AND SECRET KEY MANAGEMENT
================================================================================

CREATING API KEYS:
------------------
1. Log in to Bybit account
2. Navigate to API Management
3. Create API Key
4. Configure permissions:
   - Read-Write: Trading and account access
   - Read-Only: Market data and account viewing
   - No Transfer/Withdrawal: Recommended for trading
5. Set IP restrictions (whitelist)
6. Complete 2FA verification
7. Save API Key and Secret Key

API KEY TYPES:
--------------
System Generated (Standard):
- For personal use
- Full API access with permission control

Connected Apps (OAuth):
- Third-party applications
- Limited permissions
- Revocable access

SECURITY RECOMMENDATIONS:
-------------------------
1. Enable IP whitelist (mandatory for fund operations)
2. Use read-only keys for market data
3. Separate keys for trading and monitoring
4. Never enable withdrawal/transfer for bots
5. Rotate keys every 90 days
6. Store keys encrypted
7. Monitor API usage logs

API KEY LIMITS:
---------------
- Maximum 20 API keys per account (Master account)
- Up to 50 IPs in whitelist
- Sub-accounts can have their own keys

================================================================================
                          AUTHENTICATION METHODS
================================================================================

AUTHENTICATION PROCESS:
-----------------------
Bybit V5 uses HMAC SHA256 signature authentication.

Required Headers:
- X-BAPI-API-KEY: Your API key
- X-BAPI-SIGN: HMAC SHA256 signature
- X-BAPI-TIMESTAMP: Current timestamp (milliseconds)
- X-BAPI-RECV-WINDOW: Request validity window (default: 5000ms)

SIGNATURE GENERATION:
---------------------
For GET requests:
  sign_string = timestamp + api_key + recv_window + query_string

For POST requests:
  sign_string = timestamp + api_key + recv_window + request_body

Then: signature = HMAC_SHA256(sign_string, secret_key)

C++ AUTHENTICATION IMPLEMENTATION:
----------------------------------

#include <iostream>
#include <string>
#include <sstream>
#include <iomanip>
#include <chrono>
#include <openssl/hmac.h>
#include <openssl/sha.h>
#include <curl/curl.h>
#include <nlohmann/json.hpp>

using json = nlohmann::json;

class BybitAuth {
private:
    std::string api_key;
    std::string secret_key;

    std::string hmac_sha256_hex(const std::string& data, const std::string& key) {
        unsigned char* digest;
        unsigned int digest_len;

        digest = HMAC(EVP_sha256(),
                      key.c_str(), key.length(),
                      (unsigned char*)data.c_str(), data.length(),
                      NULL, &digest_len);

        std::stringstream ss;
        for(unsigned int i = 0; i < digest_len; i++) {
            ss << std::hex << std::setw(2) << std::setfill('0')
               << (int)digest[i];
        }
        return ss.str();
    }

    long long get_timestamp() {
        auto now = std::chrono::system_clock::now();
        auto duration = now.time_since_epoch();
        return std::chrono::duration_cast<std::chrono::milliseconds>(duration).count();
    }

public:
    BybitAuth(const std::string& key, const std::string& secret)
        : api_key(key), secret_key(secret) {}

    struct AuthHeaders {
        std::string api_key;
        std::string timestamp;
        std::string signature;
        std::string recv_window;
    };

    AuthHeaders generate_headers(const std::string& params_or_body,
                                 const std::string& recv_window = "5000") {
        AuthHeaders headers;
        headers.api_key = api_key;
        headers.timestamp = std::to_string(get_timestamp());
        headers.recv_window = recv_window;

        // Create signature string
        std::string sign_string = headers.timestamp + api_key +
                                 recv_window + params_or_body;

        // Generate signature
        headers.signature = hmac_sha256_hex(sign_string, secret_key);

        return headers;
    }
};

class BybitClient {
private:
    std::string api_key;
    std::string secret_key;
    std::string base_url = "https://api.bybit.com";
    bool testnet = false;

    BybitAuth auth;

    static size_t WriteCallback(void* contents, size_t size,
                               size_t nmemb, std::string* userp) {
        userp->append((char*)contents, size * nmemb);
        return size * nmemb;
    }

    std::string make_request(const std::string& endpoint,
                            const std::string& method = "GET",
                            const json& params = {}) {
        CURL* curl = curl_easy_init();
        std::string response;

        if(curl) {
            std::string url = base_url + endpoint;
            std::string params_str = "";

            if(method == "GET" && !params.empty()) {
                params_str = "?";
                for(auto& el : params.items()) {
                    params_str += el.key() + "=" + el.value().dump() + "&";
                }
                params_str.pop_back(); // Remove trailing &
                url += params_str;
            }

            std::string body_str = "";
            if(method == "POST" && !params.empty()) {
                body_str = params.dump();
            }

            auto headers_data = auth.generate_headers(
                method == "GET" ? params_str.substr(1) : body_str
            );

            struct curl_slist* headers = NULL;
            headers = curl_slist_append(headers,
                ("X-BAPI-API-KEY: " + headers_data.api_key).c_str());
            headers = curl_slist_append(headers,
                ("X-BAPI-SIGN: " + headers_data.signature).c_str());
            headers = curl_slist_append(headers,
                ("X-BAPI-TIMESTAMP: " + headers_data.timestamp).c_str());
            headers = curl_slist_append(headers,
                ("X-BAPI-RECV-WINDOW: " + headers_data.recv_window).c_str());
            headers = curl_slist_append(headers, "Content-Type: application/json");

            curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
            curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers);
            curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, WriteCallback);
            curl_easy_setopt(curl, CURLOPT_WRITEDATA, &response);

            if(method == "POST") {
                curl_easy_setopt(curl, CURLOPT_POSTFIELDS, body_str.c_str());
            }

            CURLcode res = curl_easy_perform(curl);
            if(res != CURLE_OK) {
                std::cerr << "Request failed: " << curl_easy_strerror(res) << std::endl;
            }

            curl_slist_free_all(headers);
            curl_easy_cleanup(curl);
        }
        return response;
    }

public:
    BybitClient(const std::string& key, const std::string& secret, bool use_testnet = false)
        : api_key(key), secret_key(secret), testnet(use_testnet), auth(key, secret) {
        if(testnet) {
            base_url = "https://api-testnet.bybit.com";
        }
    }

    // Market Data
    json get_server_time() {
        std::string response = make_request("/v5/market/time");
        return json::parse(response);
    }

    json get_tickers(const std::string& category, const std::string& symbol = "") {
        json params = {{"category", category}};
        if(!symbol.empty()) {
            params["symbol"] = symbol;
        }
        std::string response = make_request("/v5/market/tickers", "GET", params);
        return json::parse(response);
    }

    json get_orderbook(const std::string& category, const std::string& symbol, int limit = 25) {
        json params = {
            {"category", category},
            {"symbol", symbol},
            {"limit", limit}
        };
        std::string response = make_request("/v5/market/orderbook", "GET", params);
        return json::parse(response);
    }

    json get_kline(const std::string& category, const std::string& symbol,
                  const std::string& interval, int limit = 200) {
        json params = {
            {"category", category},
            {"symbol", symbol},
            {"interval", interval},
            {"limit", limit}
        };
        std::string response = make_request("/v5/market/kline", "GET", params);
        return json::parse(response);
    }

    // Trading
    json place_order(const std::string& category, const std::string& symbol,
                    const std::string& side, const std::string& order_type,
                    const std::string& qty, const std::string& price = "") {
        json params = {
            {"category", category},
            {"symbol", symbol},
            {"side", side},
            {"orderType", order_type},
            {"qty", qty}
        };

        if(!price.empty() && order_type == "Limit") {
            params["price"] = price;
        }

        std::string response = make_request("/v5/order/create", "POST", params);
        return json::parse(response);
    }

    json cancel_order(const std::string& category, const std::string& symbol,
                     const std::string& order_id) {
        json params = {
            {"category", category},
            {"symbol", symbol},
            {"orderId", order_id}
        };
        std::string response = make_request("/v5/order/cancel", "POST", params);
        return json::parse(response);
    }

    json get_open_orders(const std::string& category, const std::string& symbol = "") {
        json params = {{"category", category}};
        if(!symbol.empty()) {
            params["symbol"] = symbol;
        }
        std::string response = make_request("/v5/order/realtime", "GET", params);
        return json::parse(response);
    }

    // Account
    json get_wallet_balance(const std::string& account_type) {
        json params = {{"accountType", account_type}};
        std::string response = make_request("/v5/account/wallet-balance", "GET", params);
        return json::parse(response);
    }

    json get_positions(const std::string& category, const std::string& symbol = "") {
        json params = {{"category", category}};
        if(!symbol.empty()) {
            params["symbol"] = symbol;
        }
        std::string response = make_request("/v5/position/list", "GET", params);
        return json::parse(response);
    }
};

// Usage Example:
int main() {
    BybitClient client("your_api_key", "your_secret_key");

    // Get ticker
    json ticker = client.get_tickers("spot", "BTCUSDT");
    std::cout << "Ticker: " << ticker.dump(2) << std::endl;

    // Place limit order
    json order = client.place_order("spot", "BTCUSDT", "Buy", "Limit", "0.001", "45000");
    std::cout << "Order: " << order.dump(2) << std::endl;

    // Get wallet balance
    json balance = client.get_wallet_balance("UNIFIED");
    std::cout << "Balance: " << balance.dump(2) << std::endl;

    return 0;
}

================================================================================
                          RATE LIMITS AND RESTRICTIONS
================================================================================

RATE LIMIT STRUCTURE:
---------------------
Bybit implements per-endpoint rate limits based on user tier.

STANDARD TIER:
Public Endpoints:
- 50 requests per second per IP

Private Endpoints:
- 10 requests per second (order placement)
- 20 requests per second (account queries)

VIP TIERS:
Higher rate limits available for VIP users based on trading volume and assets.

RATE LIMIT HEADERS:
-------------------
Response includes:
- X-Bapi-Limit-Status: Remaining requests
- X-Bapi-Limit: Total allowed requests
- X-Bapi-Limit-Reset-Timestamp: Reset time

HANDLING RATE LIMITS:
---------------------
HTTP 429: Too Many Requests
{
  "retCode": 10006,
  "retMsg": "too many visits!",
  "result": {}
}

Best Practices:
1. Monitor rate limit headers
2. Implement exponential backoff
3. Use WebSocket for real-time data
4. Batch operations
5. Upgrade to VIP for higher limits

================================================================================
                          MARKET DATA STRUCTURE
================================================================================

TICKER:
-------
{
  "retCode": 0,
  "retMsg": "OK",
  "result": {
    "category": "spot",
    "list": [{
      "symbol": "BTCUSDT",
      "lastPrice": "50000",
      "highPrice24h": "50500",
      "lowPrice24h": "49000",
      "volume24h": "12345.67",
      "turnover24h": "612345678.90",
      "bid1Price": "49999",
      "bid1Size": "5.2",
      "ask1Price": "50001",
      "ask1Size": "3.8"
    }]
  }
}

ORDER BOOK:
-----------
{
  "retCode": 0,
  "retMsg": "OK",
  "result": {
    "s": "BTCUSDT",
    "b": [
      ["49999", "1.5"],
      ["49998", "2.3"]
    ],
    "a": [
      ["50001", "1.2"],
      ["50002", "3.1"]
    ],
    "ts": 1701234567890,
    "u": 123456
  }
}

KLINE/CANDLESTICK:
------------------
{
  "retCode": 0,
  "retMsg": "OK",
  "result": {
    "category": "spot",
    "symbol": "BTCUSDT",
    "list": [
      ["1701234000000", "49500", "50100", "49900", "50000", "123.45", "6172500"]
    ]
  }
}
Format: [timestamp, open, high, low, close, volume, turnover]
Intervals: 1, 3, 5, 15, 30, 60, 120, 240, 360, 720, D, W, M

================================================================================
                          ORDER TYPES SUPPORTED
================================================================================

CATEGORIES:
-----------
- spot: Spot trading
- linear: USDT perpetual
- inverse: Inverse perpetual/futures
- option: Options

ORDER TYPES:
------------
1. Market: Immediate execution
2. Limit: Specified price or better
3. LimitMaker: Post-only limit (maker fee only)

TIME IN FORCE:
--------------
- GTC (Good Till Cancel): Default
- IOC (Immediate or Cancel)
- FOK (Fill or Kill)
- PostOnly: Maker-only orders

EXAMPLE ORDERS:

Market Order:
{
  "category": "spot",
  "symbol": "BTCUSDT",
  "side": "Buy",
  "orderType": "Market",
  "qty": "0.01"
}

Limit Order:
{
  "category": "spot",
  "symbol": "BTCUSDT",
  "side": "Buy",
  "orderType": "Limit",
  "qty": "0.01",
  "price": "45000",
  "timeInForce": "GTC"
}

Stop Loss (Conditional):
{
  "category": "linear",
  "symbol": "BTCUSDT",
  "side": "Sell",
  "orderType": "Market",
  "qty": "0.01",
  "triggerPrice": "49000",
  "triggerDirection": 2,
  "triggerBy": "LastPrice"
}

Take Profit:
{
  "category": "linear",
  "symbol": "BTCUSDT",
  "side": "Sell",
  "orderType": "Limit",
  "qty": "0.01",
  "price": "51000",
  "triggerPrice": "51000",
  "triggerDirection": 1
}

================================================================================
                              FEE STRUCTURE
================================================================================

SPOT TRADING (2024):
--------------------
Regular Users:
  Maker: 0.10% / Taker: 0.10%

VIP Tiers (based on 30-day volume and BIT holdings):
VIP 1 (≥ $1M volume):
  Maker: 0.080% / Taker: 0.100%

VIP 2 (≥ $5M volume):
  Maker: 0.060% / Taker: 0.090%

VIP 3 (≥ $25M volume):
  Maker: 0.040% / Taker: 0.080%

VIP 4 (≥ $100M volume):
  Maker: 0.020% / Taker: 0.070%

VIP Supreme (≥ $500M volume):
  Maker: 0.000% / Taker: 0.050%

DERIVATIVES TRADING:
--------------------
USDT Perpetual:
  Maker: 0.02% / Taker: 0.055%

Inverse Perpetual:
  Maker: -0.025% (rebate) / Taker: 0.075%

OPTIONS:
--------
  Maker: 0.02% / Taker: 0.03%

WITHDRAWAL FEES:
----------------
Variable by cryptocurrency:
- BTC: 0.0005 BTC
- ETH: 0.005 ETH
- USDT (TRC20): 1 USDT
- USDT (ERC20): 10 USDT

DEPOSIT FEES: Free

================================================================================
                          WEBSOCKET CHANNELS
================================================================================

CONNECTION ENDPOINTS:
---------------------
Spot Public: wss://stream.bybit.com/v5/public/spot
Linear Public: wss://stream.bybit.com/v5/public/linear
Private: wss://stream.bybit.com/v5/private

AUTHENTICATION (Private):
-------------------------
{
  "op": "auth",
  "args": ["api_key", "expires", "signature"]
}

Where:
- expires = current_timestamp + 10000
- signature = HMAC_SHA256("GET/realtime" + expires, secret_key)

PUBLIC TOPICS:
--------------
1. orderbook.{depth}.{symbol}
   Depths: 1, 50, 200, 500
   Example: orderbook.50.BTCUSDT

2. publicTrade.{symbol}
   Real-time trades

3. tickers.{symbol}
   24h ticker stats

4. kline.{interval}.{symbol}
   Candlestick updates
   Intervals: 1, 3, 5, 15, 30, 60, 120, 240, 360, 720, D, W, M

5. liquidation.{symbol}
   Liquidation orders

PRIVATE TOPICS:
---------------
1. position
   Position updates

2. execution
   Trade execution notifications

3. order
   Order updates

4. wallet
   Wallet balance changes

SUBSCRIPTION FORMAT:
--------------------
{
  "op": "subscribe",
  "args": ["orderbook.50.BTCUSDT", "publicTrade.BTCUSDT"]
}

WEBSOCKET C++ EXAMPLE:
----------------------

#include <websocketpp/config/asio_client.hpp>
#include <websocketpp/client.hpp>

typedef websocketpp::client<websocketpp::config::asio_tls_client> ws_client;

class BybitWebSocket {
private:
    ws_client client;
    std::string api_key;
    std::string secret_key;

    void on_message(websocketpp::connection_hdl hdl, ws_client::message_ptr msg) {
        json j = json::parse(msg->get_payload());
        std::cout << "Message: " << j.dump(2) << std::endl;
    }

    void on_open(websocketpp::connection_hdl hdl) {
        // Subscribe to channels
        json subscribe = {
            {"op", "subscribe"},
            {"args", {"orderbook.50.BTCUSDT", "publicTrade.BTCUSDT"}}
        };
        client.send(hdl, subscribe.dump(), websocketpp::frame::opcode::text);
    }

public:
    BybitWebSocket(const std::string& key = "", const std::string& secret = "")
        : api_key(key), secret_key(secret) {
        client.init_asio();
        client.set_message_handler(bind(&BybitWebSocket::on_message, this, ::_1, ::_2));
        client.set_open_handler(bind(&BybitWebSocket::on_open, this, ::_1));
    }

    void connect(const std::string& uri) {
        websocketpp::lib::error_code ec;
        ws_client::connection_ptr con = client.get_connection(uri, ec);
        client.connect(con);
        client.run();
    }
};

================================================================================
                            BEST PRACTICES
================================================================================

1. SECURITY:
------------
- Use IP whitelist for all production keys
- Separate keys for different strategies
- Never enable withdrawal/transfer for bots
- Rotate keys quarterly
- Monitor API logs daily
- Enable 2FA on account

2. ERROR HANDLING:
------------------
- Check retCode in responses (0 = success)
- Implement retry with exponential backoff
- Handle rate limits (retCode 10006)
- Log all errors with context
- Validate parameters before sending

3. PERFORMANCE:
---------------
- Use WebSocket for market data (lower latency)
- Maintain local order book
- Use testnet for development
- Enable HTTP/2 when available
- Connection pooling for REST

4. UNIFIED TRADING ACCOUNT:
---------------------------
- Use UTA for margin efficiency
- Supports cross-margin across products
- Single account for spot, derivatives, options
- Better capital utilization

================================================================================
                        GEOGRAPHIC RESTRICTIONS
================================================================================

RESTRICTED REGIONS:
-------------------
- United States (restricted access)
- Mainland China
- Singapore (restricted features)
- Countries under international sanctions

SUPPORTED REGIONS:
------------------
- Most countries globally
- Strong presence in Asia, Europe, MENA
- Check local regulations

VPN USAGE:
----------
- Not recommended
- May trigger security checks
- Risk of account restrictions

================================================================================
                          KYC REQUIREMENTS
================================================================================

LEVEL 1 (Basic):
----------------
- Email verification
- Withdrawal: 2 BTC/day
- Spot trading enabled

LEVEL 2 (Intermediate):
-----------------------
- ID verification
- Facial recognition
- Withdrawal: 50 BTC/day
- Full trading access

LEVEL 3 (Advanced):
-------------------
- Address verification
- Enhanced verification
- Withdrawal: 100 BTC/day
- Institutional features

CORPORATE ACCOUNTS:
-------------------
- Business documentation
- UBO information
- Enhanced due diligence
- Dedicated account manager

================================================================================
                          SUPPORT RESOURCES
================================================================================

DOCUMENTATION:
--------------
- API Docs: https://bybit-exchange.github.io/docs/v5/intro
- Help Center: https://www.bybit.com/en-US/help-center/
- GitHub: https://github.com/bybit-exchange
- Postman Collection: Available on GitHub

OFFICIAL SUPPORT:
-----------------
- Live Chat: 24/7 support
- Email: support@bybit.com
- Telegram: @BybitAPI (official)
- VIP Support: For institutional clients

STATUS PAGE:
------------
- https://bybit-exchange.github.io/bybit-status/

TESTNET:
--------
- Website: https://testnet.bybit.com
- API: https://api-testnet.bybit.com
- WebSocket: wss://stream-testnet.bybit.com
- Free test funds available

COMMUNITY:
----------
- Reddit: r/Bybit
- Twitter: @Bybit_Official
- Discord: Official Bybit community

================================================================================
                              END OF DOCUMENT
================================================================================
